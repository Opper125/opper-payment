<!DOCTYPE html><html lang="my"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>OPPER Payment - အုပ်ချုပ်သူထိန်းချုပ်ရာနေရာ</title><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar&display=swap" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>:root{--primary:#ff4d4d;--primary-dark:#e63939;--secondary:#0d0d2b;--secondary-light:#1e1e5f;--accent:#00ccff;--success:#33cc33;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#212529;--gray:#6c757d;--border-radius:8px;--shadow:0 4px 6px rgba(0,0,0,0.1)}*{margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans Myanmar','Pyidaungsu',sans-serif}body{background-color:#f5f5f5;color:var(--dark)}.container{display:flex;min-height:100vh}.sidebar{width:250px;background:var(--secondary);color:white;padding:20px;transition:all 0.3s ease}.sidebar.collapsed{width:80px}.sidebar-header{display:flex;align-items:center;margin-bottom:30px}.sidebar-header img{width:40px;height:40px;margin-right:10px}.sidebar-header h2{font-size:1.2rem;white-space:nowrap;overflow:hidden}.sidebar.collapsed .sidebar-header h2{display:none}.sidebar-menu{list-style:none}.sidebar-menu li{margin-bottom:10px}.sidebar-menu a{display:flex;align-items:center;padding:10px;color:white;text-decoration:none;border-radius:var(--border-radius);transition:all 0.3s ease}.sidebar-menu a:hover,.sidebar-menu a.active{background:rgba(255,255,255,0.1)}.sidebar-menu .icon{margin-right:10px;font-size:1.2rem;min-width:20px;text-align:center}.sidebar.collapsed .sidebar-menu .menu-text{display:none}.main-content{flex:1;padding:20px;transition:all 0.3s ease;overflow-y:auto}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid #eee}.toggle-sidebar{background:none;border:none;color:var(--dark);font-size:1.5rem;cursor:pointer}.user-info{display:flex;align-items:center}.user-info img{width:40px;height:40px;border-radius:50%;margin-right:10px}.card{background:white;border-radius:var(--border-radius);box-shadow:var(--shadow);padding:20px;margin-bottom:20px}.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.card-title{font-size:1.2rem;font-weight:600;color:var(--secondary)}.stats-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px}.stat-card{background:white;border-radius:var(--border-radius);box-shadow:var(--shadow);padding:20px;display:flex;flex-direction:column}.stat-title{font-size:0.9rem;color:var(--gray);margin-bottom:10px}.stat-value{font-size:1.8rem;font-weight:700;color:var(--secondary)}.stat-card.primary .stat-value{color:var(--primary)}.stat-card.success .stat-value{color:var(--success)}.stat-card.warning .stat-value{color:var(--warning)}.stat-card.danger .stat-value{color:var(--danger)}.table-container{overflow-x:auto}table{width:100%;border-collapse:collapse}th,td{padding:12px 15px;text-align:left;border-bottom:1px solid #eee}th{background-color:#f8f9fa;font-weight:600}tr:hover{background-color:#f8f9fa}.status{padding:5px 10px;border-radius:20px;font-size:0.8rem;font-weight:500}.status.pending{background-color:rgba(255,193,7,0.2);color:#856404}.status.approved{background-color:rgba(40,167,69,0.2);color:#155724}.status.rejected{background-color:rgba(220,53,69,0.2);color:#721c24}.action-btn{padding:6px 12px;border-radius:var(--border-radius);border:none;cursor:pointer;font-size:0.9rem;transition:all 0.3s ease}.view-btn{background-color:var(--accent);color:white}.approve-btn{background-color:var(--success);color:white}.reject-btn{background-color:var(--danger);color:white}.action-btn:hover{opacity:0.9}.search-container{display:flex;margin-bottom:20px}.search-input{flex:1;padding:10px;border:1px solid #ddd;border-radius:var(--border-radius) 0 0 var(--border-radius);outline:none}.search-btn{padding:10px 15px;background:var(--primary);color:white;border:none;border-radius:0 var(--border-radius) var(--border-radius) 0;cursor:pointer}.pagination{display:flex;justify-content:center;margin-top:20px}.pagination button{padding:8px 12px;margin:0 5px;border:1px solid #ddd;background:white;cursor:pointer;border-radius:var(--border-radius)}.pagination button.active{background:var(--primary);color:white;border-color:var(--primary)}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;justify-content:center;align-items:center}.modal-content{background:white;border-radius:var(--border-radius);width:90%;max-width:500px;max-height:90vh;overflow-y:auto;padding:20px;position:relative}.close-modal{position:absolute;top:10px;right:10px;font-size:1.5rem;background:none;border:none;cursor:pointer}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;font-weight:500}.form-control{width:100%;padding:10px;border:1px solid #ddd;border-radius:var(--border-radius);outline:none}.form-control:focus{border-color:var(--primary)}.btn{padding:10px 15px;border:none;border-radius:var(--border-radius);cursor:pointer;font-weight:500}.btn-primary{background:var(--primary);color:white}.btn-success{background:var(--success);color:white}.btn-danger{background:var(--danger);color:white}.alert{padding:10px 15px;border-radius:var(--border-radius);margin-bottom:15px}.alert-success{background-color:rgba(40,167,69,0.2);color:#155724;border:1px solid rgba(40,167,69,0.3)}.alert-danger{background-color:rgba(220,53,69,0.2);color:#721c24;border:1px solid rgba(220,53,69,0.3)}.hidden{display:none}.user-detail{display:flex;margin-bottom:20px}.user-avatar{width:100px;height:100px;border-radius:50%;margin-right:20px;object-fit:cover}.user-info-detail{flex:1}.user-name{font-size:1.5rem;font-weight:600;margin-bottom:5px}.user-email{color:var(--gray);margin-bottom:10px}.user-meta{display:flex;flex-wrap:wrap;gap:10px}.passport-images{display:flex;gap:20px;margin-top:20px}.passport-image{width:200px;border-radius:var(--border-radius);box-shadow:var(--shadow)}.transaction-detail{display:flex;flex-direction:column;gap:15px}.transaction-amount{font-size:2rem;font-weight:700;color:var(--primary);text-align:center;margin:20px 0}.transaction-parties{display:flex;justify-content:space-between;align-items:center;margin:20px 0}.transaction-party{text-align:center;flex:1}.transaction-arrow{font-size:2rem;color:var(--gray)}.transaction-meta{background-color:#f8f9fa;padding:15px;border-radius:var(--border-radius)}.transaction-meta p{margin-bottom:10px;display:flex;justify-content:space-between}.transaction-meta p:last-child{margin-bottom:0}.transaction-meta strong{font-weight:600}.settings-form{max-width:600px}.toggle-switch{position:relative;display:inline-block;width:60px;height:34px}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:34px}.toggle-slider:before{position:absolute;content:"";height:26px;width:26px;left:4px;bottom:4px;background-color:white;transition:.4s;border-radius:50%}input:checked + .toggle-slider{background-color:var(--success)}input:focus + .toggle-slider{box-shadow:0 0 1px var(--success)}input:checked + .toggle-slider:before{transform:translateX(26px)}.login-container{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,var(--secondary),var(--secondary-light))}.login-card{background:white;border-radius:var(--border-radius);box-shadow:var(--shadow);padding:30px;width:90%;max-width:400px}.login-logo{text-align:center;margin-bottom:30px}.login-logo img{width:80px;height:80px}.login-title{text-align:center;font-size:1.5rem;font-weight:600;margin-bottom:30px;color:var(--secondary)}.login-btn{width:100%;padding:12px;background:var(--primary);color:white;border:none;border-radius:var(--border-radius);font-size:1rem;font-weight:500;cursor:pointer;transition:all 0.3s ease}.login-btn:hover{background:var(--primary-dark)}@media (max-width:768px){.container{flex-direction:column}.sidebar{width:100%;position:fixed;bottom:0;left:0;z-index:100;padding:10px;height:auto}.sidebar-header{display:none}.sidebar-menu{display:flex;justify-content:space-around}.sidebar-menu li{margin-bottom:0}.sidebar-menu a{flex-direction:column;padding:10px 5px;text-align:center}.sidebar-menu .icon{margin-right:0;margin-bottom:5px}.main-content{margin-bottom:70px}.stats-container{grid-template-columns:1fr}.user-detail{flex-direction:column;align-items:center;text-align:center}.user-avatar{margin-right:0;margin-bottom:20px}.passport-images{flex-direction:column;align-items:center}.transaction-parties{flex-direction:column;gap:20px}.transaction-arrow{transform:rotate(90deg)}}</style></head><body><div id="login-page" class="login-container"><div class="login-card"><div class="login-logo"><img src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="OPPER လိုဂို"></div><h1 class="login-title">OPPER Payment - အုပ်ချုပ်သူဝင်ရောက်ရန်</h1><div class="alert alert-danger hidden" id="login-error"></div><form id="login-form"><div class="form-group"><label for="email">အီးမေးလ်</label><input type="email" id="email" class="form-control" placeholder="အီးမေးလ်ထည့်ပါ" value="crakb68@gmail.com" required></div><div class="form-group"><label for="password">စကားဝှက်</label><input type="password" id="password" class="form-control" placeholder="စကားဝှက်ထည့်ပါ" value="155872" required></div><button type="submit" class="login-btn">ဝင်ရောက်ရန်</button></form></div></div><div id="admin-dashboard" class="container hidden"><div class="sidebar" id="sidebar"><div class="sidebar-header"><img src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="OPPER လိုဂို"><h2>OPPER အုပ်ချုပ်သူ</h2></div><ul class="sidebar-menu"><li><a href="#" class="active" data-page="dashboard"><span class="icon">📊</span><span class="menu-text">ထိန်းချုပ်ရာနေရာ</span></a></li><li><a href="#" data-page="users"><span class="icon">👥</span><span class="menu-text">အသုံးပြုသူများ</span></a></li><li><a href="#" data-page="transactions"><span class="icon">💸</span><span class="menu-text">ငွေပေးငွေယူများ</span></a></li><li><a href="#" data-page="verifications"><span class="icon">🔍</span><span class="menu-text">အတည်ပြုစစ်ဆေးမှုများ</span></a></li><li><a href="#" data-page="settings"><span class="icon">⚙️</span><span class="menu-text">ဆက်တင်များ</span></a></li><li><a href="#" id="logout-link"><span class="icon">🚪</span><span class="menu-text">အကောင့်ထွက်ရန်</span></a></li></ul></div><div class="main-content"><div class="header"><button class="toggle-sidebar">☰</button><div class="user-info"><img src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="အုပ်ချုပ်သူ"><span id="admin-name">အုပ်ချုပ်သူ</span></div></div><div id="dashboard-page" class="page"><div class="stats-container"><div class="stat-card primary"><div class="stat-title">စုစုပေါင်းအသုံးပြုသူများ</div><div class="stat-value" id="total-users">0</div></div><div class="stat-card success"><div class="stat-title">အတည်ပြုပြီးအသုံးပြုသူများ</div><div class="stat-value" id="verified-users">0</div></div><div class="stat-card warning"><div class="stat-title">ဆိုင်းငံ့ထားသော အတည်ပြုမှုများ</div><div class="stat-value" id="pending-verifications">0</div></div><div class="stat-card danger"><div class="stat-title">စုစုပေါင်းငွေပေးငွေယူ</div><div class="stat-value" id="total-transactions">0</div></div></div><div class="card"><div class="card-header"><h2 class="card-title">လတ်တလော ငွေပေးငွေယူများ</h2></div><div class="table-container"><table><thead><tr><th>ID</th><th>ပို့သူ</th><th>လက်ခံသူ</th><th>ပမာဏ</th><th>ရက်စွဲ</th><th>အခြေအနေ</th></tr></thead><tbody id="recent-transactions"><tr><td colspan="6" class="text-center">ငွေပေးငွေယူများ ထုတ်ယူနေသည်...</td></tr></tbody></table></div></div><div class="card"><div class="card-header"><h2 class="card-title">လတ်တလော အသုံးပြုသူများ</h2></div><div class="table-container"><table><thead><tr><th>ID</th><th>အီးမေးလ်</th><th>လက်ကျန်ငွေ</th><th>အခြေအနေ</th><th>စတင်ရက်</th></tr></thead><tbody id="recent-users"><tr><td colspan="5" class="text-center">အသုံးပြုသူများ ထုတ်ယူနေသည်...</td></tr></tbody></table></div></div></div><div id="users-page" class="page hidden"><div class="card"><div class="card-header"><h2 class="card-title">အသုံးပြုသူအားလုံး</h2><div class="search-container"><input type="text" id="user-search" class="search-input" placeholder="ID၊ အီးမေးလ် သို့မဟုတ် ဖုန်းဖြင့်ရှာရန်..."><button class="search-btn" id="search-user-btn">ရှာရန်</button></div></div><div class="table-container"><table><thead><tr><th>ID</th><th>အီးမေးလ်</th><th>ဖုန်း</th><th>လက်ကျန်ငွေ</th><th>အခြေအနေ</th><th>လုပ်ဆောင်ချက်များ</th></tr></thead><tbody id="users-table"><tr><td colspan="6" class="text-center">အသုံးပြုသူများ ထုတ်ယူနေသည်...</td></tr></tbody></table></div><div class="pagination" id="users-pagination"></div></div></div><div id="transactions-page" class="page hidden"><div class="card"><div class="card-header"><h2 class="card-title">ငွေပေးငွေယူအားလုံး</h2><div class="search-container"><input type="text" id="transaction-search" class="search-input" placeholder="ID၊ ဖုန်း သို့မဟုတ် ပမာဏဖြင့်ရှာရန်..."><button class="search-btn" id="search-transaction-btn">ရှာရန်</button></div></div><div class="table-container"><table><thead><tr><th>ID</th><th>ပို့သူ</th><th>လက်ခံသူ</th><th>ပမာဏ</th><th>ရက်စွဲ</th><th>အခြေအနေ</th><th>လုပ်ဆောင်ချက်များ</th></tr></thead><tbody id="transactions-table"><tr><td colspan="7" class="text-center">ငွေပေးငွေယူများ ထုတ်ယူနေသည်...</td></tr></tbody></table></div><div class="pagination" id="transactions-pagination"></div></div></div><div id="verifications-page" class="page hidden"><div class="card"><div class="card-header"><h2 class="card-title">ဆိုင်းငံ့ထားသော အတည်ပြုမှုများ</h2></div><div class="table-container"><table><thead><tr><th>ID</th><th>အီးမေးလ်</th><th>ဖုန်း</th><th>တင်သွင်းချိန်</th><th>လုပ်ဆောင်ချက်များ</th></tr></thead><tbody id="verifications-table"><tr><td colspan="5" class="text-center">အတည်ပြုမှုများ ထုတ်ယူနေသည်...</td></tr></tbody></table></div></div></div><div id="settings-page" class="page hidden"><div class="card"><div class="card-header"><h2 class="card-title">စနစ်ဆက်တင်များ</h2></div><div class="alert alert-success hidden" id="settings-success">ဆက်တင်များ သိမ်းဆည်းပြီးပါပြီ!</div><div class="alert alert-danger hidden" id="settings-error"></div><form id="settings-form" class="settings-form"><div class="form-group"><label for="allow-transfers">ငွေလွှဲပြောင်းမှု ခွင့်ပြုရန်</label><label class="toggle-switch"><input type="checkbox" id="allow-transfers"><span class="toggle-slider"></span></label><p class="form-text">အသုံးပြုသူများအကြား ငွေလွှဲပြောင်းမှုကို ဖွင့်/ပိတ်ရန်</p></div><div class="form-group"><label for="max-transfer">အများဆုံးလွှဲပြောင်းပမာဏ (ကျပ်)</label><input type="number" id="max-transfer" class="form-control" min="0"></div><div class="form-group"><label for="admin-email">အုပ်ချုပ်သူ အီးမေးလ်</label><input type="email" id="admin-email" class="form-control" value="crakb68@gmail.com"></div><button type="submit" class="btn btn-primary">သိမ်းဆည်းရန်</button></form></div></div></div></div><div id="user-modal" class="modal"><div class="modal-content"><button class="close-modal" id="close-user-modal">×</button><h2>အသုံးပြုသူအသေးစိတ်</h2><div id="user-detail-content"></div><div class="form-group"><button class="btn btn-success approve-user-btn">အသုံးပြုသူ အတည်ပြုရန်</button><button class="btn btn-danger reject-user-btn">အသုံးပြုသူ ပယ်ဖျက်ရန်</button></div></div></div><div id="transaction-modal" class="modal"><div class="modal-content"><button class="close-modal" id="close-transaction-modal">×</button><h2>ငွေပေးငွေယူအသေးစိတ်</h2><div id="transaction-detail-content"></div></div></div><script>const supabaseUrl="https://vtsczzlnhsrgnbkfyizi.supabase.co";const supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0c2N6emxuaHNyZ25ia2Z5aXppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2ODYwODMsImV4cCI6MjA1ODI2MjA4M30.LjP2g0WXgg6FVTM5gPIkf_qlXakkj8Hf5xzXVsx7y68";const supabase=window.supabase.createClient(supabaseUrl,supabaseKey);let currentPage="dashboard";let currentUser=null;let usersPage=1;let transactionsPage=1;const PAGE_SIZE=10;const loginPage=document.getElementById("login-page");const adminDashboard=document.getElementById("admin-dashboard");const loginForm=document.getElementById("login-form");const loginError=document.getElementById("login-error");const sidebar=document.getElementById("sidebar");const toggleSidebarBtn=document.querySelector(".toggle-sidebar");const menuLinks=document.querySelectorAll(".sidebar-menu a[data-page]");const logoutLink=document.getElementById("logout-link");const adminName=document.getElementById("admin-name");document.addEventListener("DOMContentLoaded",()=>{initApp();setupEventListeners();});async function initApp(){try{const{data:{session},error}=await supabase.auth.getSession();if(error){console.error("ဆက်ရှင်အမှား:",error.message);showLoginPage();return}if(session){const{data:adminData,error:adminError}=await supabase.from("admins").select("*").eq("auth_id",session.user.id).single();if(adminError||!adminData){console.error("အုပ်ချုပ်သူမဟုတ်ပါ:",adminError?.message);await supabase.auth.signOut();showLoginPage();return}currentUser={id:session.user.id,email:session.user.email,name:adminData.name||"အုပ်ချုပ်သူ"};showDashboard()}else{showLoginPage()}}catch(error){console.error("စတင်မှုအမှား:",error.message);showLoginPage()}}function setupEventListeners(){loginForm.addEventListener("submit",handleLogin);toggleSidebarBtn.addEventListener("click",()=>{sidebar.classList.toggle("collapsed")});menuLinks.forEach(link=>{link.addEventListener("click",(e)=>{e.preventDefault();const page=link.getAttribute("data-page");navigateTo(page)})});logoutLink.addEventListener("click",handleLogout);document.getElementById("settings-form").addEventListener("submit",saveSettings);document.getElementById("search-user-btn").addEventListener("click",()=>{searchUsers(document.getElementById("user-search").value)});document.getElementById("search-transaction-btn").addEventListener("click",()=>{searchTransactions(document.getElementById("transaction-search").value)});document.getElementById("close-user-modal").addEventListener("click",()=>{document.getElementById("user-modal").style.display="none"});document.getElementById("close-transaction-modal").addEventListener("click",()=>{document.getElementById("transaction-modal").style.display="none"});window.addEventListener("click",(e)=>{if(e.target.classList.contains("modal")){e.target.style.display="none"}})}async function handleLogin(e){e.preventDefault();const email=document.getElementById("email").value;const password=document.getElementById("password").value;try{const{data,error}=await supabase.auth.signInWithPassword({email,password});if(error){loginError.textContent="အီးမေးလ် သို့မဟုတ် စကားဝှက် မမှန်ကန်ပါ";loginError.classList.remove("hidden");return}const{data:adminData,error:adminError}=await supabase.from("admins").select("*").eq("auth_id",data.user.id).single();if(adminError||!adminData){loginError.textContent="သင်သည် အုပ်ချုပ်သူအခွင့်အရေးမရှိပါ";loginError.classList.remove("hidden");await supabase.auth.signOut();return}currentUser={id:data.user.id,email:data.user.email,name:adminData.name||"အုပ်ချုပ်သူ"};loginError.classList.add("hidden");showDashboard()}catch(error){console.error("ဝင်ရောက်မှုအမှား:",error.message);loginError.textContent="ဝင်ရောက်မှု မအောင်မြင်ပါ၊ နောက်မှ ထပ်ကြိုးစားပါ";loginError.classList.remove("hidden")}}async function handleLogout(e){e.preventDefault();try{await supabase.auth.signOut();currentUser=null;showLoginPage()}catch(error){console.error("အကောင့်ထွက်မှုအမှား:",error.message);loginError.textContent="အကောင့်ထွက်ရန် မအောင်မြင်ပါ၊ နောက်မှ ထပ်ကြိုးစားပါ";loginError.classList.remove("hidden")}}function showLoginPage(){loginPage.classList.remove("hidden");adminDashboard.classList.add("hidden");loginError.classList.add("hidden")}function showDashboard(){loginPage.classList.add("hidden");adminDashboard.classList.remove("hidden");adminName.textContent=currentUser.name;loadDashboardData();setupRealtimeSubscriptions()}function navigateTo(page){document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));document.getElementById(`${page}-page`).classList.remove("hidden");menuLinks.forEach(link=>{link.classList.remove("active");if(link.getAttribute("data-page")===page)link.classList.add("active")});currentPage=page;switch(page){case"dashboard":loadDashboardData();break;case"users":loadUsers();break;case"transactions":loadTransactions();break;case"verifications":loadVerifications();break;case"settings":loadSettings();break}}async function loadDashboardData(){try{const[{count:totalUsers},{count:verifiedUsers},{count:pendingVerifications},{count:totalTransactions}]=await Promise.all([supabase.from("users").select("*",{count:"exact",head:true}),supabase.from("users").select("*",{count:"exact",head:true}).eq("passport_status","approved"),supabase.from("users").select("*",{count:"exact",head:true}).eq("passport_status","pending"),supabase.from("transactions").select("*",{count:"exact",head:true})]);document.getElementById("total-users").textContent=totalUsers||0;document.getElementById("verified-users").textContent=verifiedUsers||0;document.getElementById("pending-verifications").textContent=pendingVerifications||0;document.getElementById("total-transactions").textContent=totalTransactions||0;const{data:recentTransactions,error:transactionsError}=await supabase.from("transactions").select("*").order("created_at",{ascending:false}).limit(5);if(transactionsError){console.error("လတ်တလော ငွေပေးငွေယူအမှား:",transactionsError.message);return}const recentTransactionsTable=document.getElementById("recent-transactions");recentTransactionsTable.innerHTML="";if(!recentTransactions||recentTransactions.length===0){recentTransactionsTable.innerHTML=`<tr><td colspan="6" class="text-center">ငွေပေးငွေယူများ မတွေ့ပါ</td></tr>`}else{recentTransactions.forEach(transaction=>{recentTransactionsTable.innerHTML+=`<tr><td>${transaction.id}</td><td>${transaction.from_phone}</td><td>${transaction.to_phone}</td><td>${transaction.amount} ကျပ်</td><td>${formatDate(transaction.created_at)}</td><td><span class="status ${transaction.status}">${translateStatus(transaction.status)}</span></td></tr>`})}const{data:recentUsers,error:usersError}=await supabase.from("users").select("*").order("created_at",{ascending:false}).limit(5);if(usersError){console.error("လတ်တလော အသုံးပြုသူအမှား:",usersError.message);return}const recentUsersTable=document.getElementById("recent-users");recentUsersTable.innerHTML="";if(!recentUsers||recentUsers.length===0){recentUsersTable.innerHTML=`<tr><td colspan="5" class="text-center">အသုံးပြုသူများ မတွေ့ပါ</td></tr>`}else{recentUsers.forEach(user=>{recentUsersTable.innerHTML+=`<tr><td>${user.user_id}</td><td>${user.email}</td><td>${user.balance} ကျပ်</td><td><span class="status ${user.passport_status}">${translateStatus(user.passport_status)}</span></td><td>${formatDate(user.created_at)}</td></tr>`})}}catch(error){console.error("ထိန်းချုပ်ရာနေရာ ဒေတာအမှား:",error.message);alert("ဒေတာထုတ်ယူမှု မအောင်မြင်ပါ၊ နောက်မှ ထပ်ကြိုးစားပါ")}}async function loadUsers(page=1,search=""){try{let query=supabase.from("users").select("*",{count:"exact"});if(search){query=query.or(`user_id.ilike.%${search}%,email.ilike.%${search}%,phone.ilike.%${search}%`)}const from=(page-1)*PAGE_SIZE;const to=from+PAGE_SIZE-1;const{data:users,error,count}=await query.order("created_at",{ascending:false}).range(from,to);if(error){console.error("အသုံးပြုသူအမှား:",error.message);alert("အသုံးပြုသူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ");return}const usersTable=document.getElementById("users-table");usersTable.innerHTML="";if(!users||users.length===0){usersTable.innerHTML=`<tr><td colspan="6" class="text-center">အသုံးပြုသူများ မတွေ့ပါ</td></tr>`}else{users.forEach(user=>{usersTable.innerHTML+=`<tr><td>${user.user_id}</td><td>${user.email}</td><td>${user.phone||"မသတ်မှတ်ထားပါ"}</td><td>${user.balance} ကျပ်</td><td><span class="status ${user.passport_status}">${translateStatus(user.passport_status)}</span></td><td><button class="action-btn view-btn" onclick="viewUser('${user.id}')">ကြည့်ရန်</button></td></tr>`})}updatePagination("users-pagination",page,Math.ceil(count/PAGE_SIZE),loadUsers);usersPage=page}catch(error){console.error("အသုံးပြုသူထုတ်ယူမှု အမှား:",error.message);alert("အသုံးပြုသူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ")}}function searchUsers(query){loadUsers(1,query)}async function loadTransactions(page=1,search=""){try{let query=supabase.from("transactions").select("*",{count:"exact"});if(search){query=query.or(`id.ilike.%${search}%,from_phone.ilike.%${search}%,to_phone.ilike.%${search}%`)}const from=(page-1)*PAGE_SIZE;const to=from+PAGE_SIZE-1;const{data:transactions,error,count}=await query.order("created_at",{ascending:false}).range(from,to);if(error){console.error("ငွေပေးငွေယူအမှား:",error.message);alert("ငွေပေးငွေယူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ");return}const transactionsTable=document.getElementById("transactions-table");transactionsTable.innerHTML="";if(!transactions||transactions.length===0){transactionsTable.innerHTML=`<tr><td colspan="7" class="text-center">ငွေပေးငွေယူများ မတွေ့ပါ</td></tr>`}else{transactions.forEach(transaction=>{transactionsTable.innerHTML+=`<tr><td>${transaction.id}</td><td>${transaction.from_phone}</td><td>${transaction.to_phone}</td><td>${transaction.amount} ကျပ်</td><td>${formatDate(transaction.created_at)}</td><td><span class="status ${transaction.status}">${translateStatus(transaction.status)}</span></td><td><button class="action-btn view-btn" onclick="viewTransaction('${transaction.id}')">ကြည့်ရန်</button></td></tr>`})}updatePagination("transactions-pagination",page,Math.ceil(count/PAGE_SIZE),loadTransactions);transactionsPage=page}catch(error){console.error("ငွေပေးငွေယူထုတ်ယူမှု အမှား:",error.message);alert("ငွေပေးငွေယူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ")}}function searchTransactions(query){loadTransactions(1,query)}async function loadVerifications(){try{const{data:verifications,error}=await supabase.from("users").select("*").eq("passport_status","pending").order("submitted_at",{ascending:false});if(error){console.error("အတည်ပြုမှုအမှား:",error.message);alert("အတည်ပြုမှုဒေတာထုတ်ယူမှု မအောင်မြင်ပါ");return}const verificationsTable=document.getElementById("verifications-table");verificationsTable.innerHTML="";if(!verifications||verifications.length===0){verificationsTable.innerHTML=`<tr><td colspan="5" class="text-center">ဆိုင်းငံ့ထားသော အတည်ပြုမှုများ မရှိပါ</td></tr>`}else{verifications.forEach(user=>{verificationsTable.innerHTML+=`<tr><td>${user.user_id}</td><td>${user.email}</td><td>${user.phone||"မသတ်မှတ်ထားပါ"}</td><td>${formatDate(user.submitted_at)}</td><td><button class="action-btn view-btn" onclick="viewUser('${user.id}')">ကြည့်ရန်</button><button class="action-btn approve-btn" onclick="approveUser('${user.id}')">အတည်ပြုရန်</button><button class="action-btn reject-btn" onclick="rejectUser('${user.id}')">ပယ်ဖျက်ရန်</button></td></tr>`})}}catch(error){console.error("အတည်ပြုမှုထုတ်ယူမှု အမှား:",error.message);alert("အတည်ပြုမှုဒေတာထုတ်ယူမှု မအောင်မြင်ပါ")}}async function loadSettings(){try{const{data:settings,error}=await supabase.from("settings").select("*").single();if(error){console.error("ဆက်တင်အမှား:",error.message);alert("ဆက်တင်ဒေတာထုတ်ယူမှု မအောင်မြင်ပါ");return}document.getElementById("allow-transfers").checked=settings.allow_transfers;document.getElementById("max-transfer").value=settings.max_transfer_amount;document.getElementById("admin-email").value=settings.admin_email||"crakb68@gmail.com"}catch(error){console.error("ဆက်တင်ထုတ်ယူမှု အမှား:",error.message);alert("ဆက်တင်ဒေတာထုတ်ယူမှု မအောင်မြင်ပါ")}}async function saveSettings(e){e.preventDefault();const settingsSuccess=document.getElementById("settings-success");const settingsError=document.getElementById("settings-error");settingsSuccess.classList.add("hidden");settingsError.classList.add("hidden");try{const allowTransfers=document.getElementById("allow-transfers").checked;const maxTransfer=parseInt(document.getElementById("max-transfer").value);const adminEmail=document.getElementById("admin-email").value;if(isNaN(maxTransfer)||maxTransfer<0){throw new Error("အများဆုံးလွှဲပြောင်းပမာဏ မမှန်ကန်ပါ")}if(!adminEmail){throw new Error("အုပ်ချုပ်သူ အီးမေးလ် ထည့်သွင်းရန် လိုအပ်ပါသည်")}const{error}=await supabase.from("settings").update({allow_transfers:allowTransfers,max_transfer_amount:maxTransfer,admin_email:adminEmail}).eq("id",1);if(error){throw error}settingsSuccess.classList.remove("hidden");setTimeout(()=>{settingsSuccess.classList.add("hidden")},3000)}catch(error){console.error("ဆက်တင်သိမ်းဆည်းမှု အမှား:",error.message);settingsError.textContent=error.message||"ဆက်တင်သိမ်းဆည်းမှု မအောင်မြင်ပါ";settingsError.classList.remove("hidden")}}async function viewUser(userId){try{const{data:user,error}=await supabase.from("users").select("*").eq("id",userId).single();if(error){console.error("အသုံးပြုသူကြည့်ရန်အမှား:",error.message);alert("အသုံးပြုသူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ");return}const userDetailContent=document.getElementById("user-detail-content");let passportImages="";if(user.passport_image&&user.selfie_image){passportImages=`<div class="passport-images"><img src="${user.passport_image}" alt="နိုင်ငံကူးလက်မှတ်" class="passport-image"><img src="${user.selfie_image}" alt="ဆယ်လ်ဖီပုံ" class="passport-image"></div>`}userDetailContent.innerHTML=`<div class="user-detail"><img src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="အသုံးပြုသူ" class="user-avatar"><div class="user-info-detail"><h3 class="user-name">ID: ${user.user_id}</h3><p class="user-email">${user.email}</p><div class="user-meta"><span class="badge badge-primary">လက်ကျန်ငွေ: ${user.balance} ကျပ်</span><span class="badge badge-${getBadgeClass(user.passport_status)}">${translateStatus(user.passport_status)}</span></div></div></div><div class="form-group"><label>ဖုန်းနံပါတ်</label><p>${user.phone||"မသတ်မှတ်ထားပါ"}</p></div><div class="form-group"><label>နိုင်ငံကူးလက်မှတ်နံပါတ်</label><p>${user.passport_number||"တင်သွင်းမထားပါ"}</p></div><div class="form-group"><label>လိပ်စာ</label><p>${user.address||"တင်သွင်းမထားပါ"}</p></div><div class="form-group"><label>တင်သွင်းချိန်</label><p>${user.submitted_at?formatDate(user.submitted_at):"တင်သွင်းမထားပါ"}</p></div><div class="form-group"><label>ဖန်တီးချိန်</label><p>${formatDate(user.created_at)}</p></div>${passportImages}`;const approveBtn=document.querySelector(".approve-user-btn");const rejectBtn=document.querySelector(".reject-user-btn");if(user.passport_status==="pending"){approveBtn.style.display="inline-block";rejectBtn.style.display="inline-block";approveBtn.onclick=()=>approveUser(user.id);rejectBtn.onclick=()=>rejectUser(user.id)}else{approveBtn.style.display="none";rejectBtn.style.display="none"}document.getElementById("user-modal").style.display="flex"}catch(error){console.error("အသုံးပြုသူကြည့်ရန်အမှား:",error.message);alert("အသုံးပြုသူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ")}}async function approveUser(userId){try{const{error}=await supabase.from("users").update({passport_status:"approved"}).eq("id",userId);if(error){console.error("အသုံးပြုသူအတည်ပြုမှု အမှား:",error.message);alert("အသုံးပြုသူ အတည်ပြုရန် မအောင်မြင်ပါ");return}document.getElementById("user-modal").style.display="none";if(currentPage==="verifications"){loadVerifications()}else if(currentPage==="users"){loadUsers(usersPage)}else if(currentPage==="dashboard"){loadDashboardData()}}catch(error){console.error("အသုံးပြုသူအတည်ပြုမှု အမှား:",error.message);alert("အသုံးပြုသူ အတည်ပြုရန် မအောင်မြင်ပါ")}}async function rejectUser(userId){try{const{error}=await supabase.from("users").update({passport_status:"rejected"}).eq("id",userId);if(error){console.error("အသုံးပြုသူပယ်ဖျက်မှု အမှား:",error.message);alert("အသုံးပြုသူ ပယ်ဖျက်ရန် မအောင်မြင်ပါ");return}document.getElementById("user-modal").style.display="none";if(currentPage==="verifications"){loadVerifications()}else if(currentPage==="users"){loadUsers(usersPage)}else if(currentPage==="dashboard"){loadDashboardData()}}catch(error){console.error("အသုံးပြုသူပယ်ဖျက်မှု အမှား:",error.message);alert("အသုံးပြုသူ ပယ်ဖျက်ရန် မအောင်မြင်ပါ")}}async function viewTransaction(transactionId){try{const{data:transaction,error}=await supabase.from("transactions").select("*").eq("id",transactionId).single();if(error){console.error("ငွေပေးငွေယူကြည့်ရန်အမှား:",error.message);alert("ငွေပေးငွေယူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ");return}const transactionDetailContent=document.getElementById("transaction-detail-content");transactionDetailContent.innerHTML=`<div class="transaction-amount">${transaction.amount} ကျပ်</div><div class="transaction-parties"><div class="transaction-party"><p>ပို့သူ</p><h3>${transaction.from_phone}</h3></div><div class="transaction-arrow">→</div><div class="transaction-party"><p>လက်ခံသူ</p><h3>${transaction.to_phone}</h3></div></div><div class="transaction-meta"><p><strong>ငွေပေးငွေယူ ID:</strong> ${transaction.id}</p><p><strong>အခြေအနေ:</strong> <span class="badge badge-${getBadgeClass(transaction.status)}">${translateStatus(transaction.status)}</span></p><p><strong>မှတ်ချက်:</strong> ${transaction.note||"မရှိ"}</p><p><strong>ရက်စွဲ:</strong> ${formatDate(transaction.created_at)}</p></div>`;document.getElementById("transaction-modal").style.display="flex"}catch(error){console.error("ငွေပေးငွေယူကြည့်ရန်အမှား:",error.message);alert("ငွေပေးငွေယူဒေတာထုတ်ယူမှု မအောင်မြင်ပါ")}}function setupRealtimeSubscriptions(){try{supabase.channel("users-changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},payload=>{if(currentPage==="dashboard"){loadDashboardData()}else if(currentPage==="users"){loadUsers(usersPage)}else if(currentPage==="verifications"){loadVerifications()}}).subscribe();supabase.channel("transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},payload=>{if(currentPage==="dashboard"){loadDashboardData()}else if(currentPage==="transactions"){loadTransactions(transactionsPage)}}).subscribe();supabase.channel("settings-changes").on("postgres_changes",{event:"*",schema:"public",table:"settings"},payload=>{if(currentPage==="settings")loadSettings()}).subscribe()}catch(error){console.error("အချိန်နှင့်တပြေးညီ အပ်ဒိတ်အမှား:",error.message)}}function formatDate(dateString){const date=new Date(dateString);return date.toLocaleString("my-MM",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function translateStatus(status){switch(status){case"pending":return"ဆိုင်းငံ့ထားသည်";case"approved":return"အတည်ပြုပြီး";case"rejected":return"ပယ်ဖျက်ပြီး";case"completed":return"ပြီးစီးပြီး";default:return status}}function getBadgeClass(status){switch(status){case"pending":return"warning";case"approved":return"success";case"rejected":return"danger";case"completed":return"success";default:return"secondary"}}function updatePagination(containerId,currentPage,totalPages,loadFunction){const container=document.getElementById(containerId);container.innerHTML="";if(totalPages<=1)return;const maxButtons=5;let startPage=Math.max(1,currentPage-Math.floor(maxButtons/2));let endPage=Math.min(totalPages,startPage+maxButtons-1);if(endPage-startPage+1<maxButtons){startPage=Math.max(1,endPage-maxButtons+1)}if(startPage>1){container.innerHTML+=`<button onclick="(${loadFunction})(${1})">«</button>`}for(let i=startPage;i<=endPage;i++){container.innerHTML+=`<button class="${i===currentPage?'active':''}" onclick="(${loadFunction})(${i})">${i}</button>`}if(endPage<totalPages){container.innerHTML+=`<button onclick="(${loadFunction})(${totalPages})">»</button>`}}</script></body></html>

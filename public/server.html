<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OPPER Payment Server - Admin Dashboard</title>
    <link rel="icon" type="image/png" href="https://github.com/Opper125/opper-payment/raw/main/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css"> <!-- Assuming styles.css is in the same directory or accessible -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Basic Admin Panel Styles (can be moved to styles.css) */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background-color: #f4f7f9;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .hidden { display: none !important; }

        /* Login Container */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        .login-box {
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .login-logo img { width: 80px; margin-bottom: 20px; }
        .login-title { font-size: 24px; color: #333; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #555; }
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .form-group input:focus { border-color: #667eea; outline: none; box-shadow: 0 0 0 2px rgba(102,126,234,0.2); }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
        }
        .btn-primary { background-color: #667eea; color: white; }
        .btn-primary:hover { background-color: #5a6fcf; }
        .btn-block { width: 100%; }
        .btn .icon { margin-left: 8px; width: 20px; height: 20px; }
        .message { padding: 10px; border-radius: 6px; margin-top: 15px; font-size: 14px; }
        .message-error { background-color: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
        .message-success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }

        /* Dashboard Layout */
        .dashboard { display: flex; min-height: 100vh; }
        .sidebar {
            width: 260px;
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }
        .sidebar.active { transform: translateX(0); }
        .sidebar-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; }
        .sidebar-header .logo img { width: 40px; margin-right: 10px; }
        .sidebar-header .logo h2 { font-size: 20px; margin: 0; color: #fff; }
        .menu-toggle { background: none; border: none; color: #ecf0f1; cursor: pointer; font-size: 24px; padding: 5px; }
        .nav-menu { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
        .nav-item .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #bdc3c7;
            text-decoration: none;
            border-radius: 6px;
            margin-bottom: 8px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .nav-item .nav-link:hover, .nav-item .nav-link.active { background-color: #34495e; color: #fff; }
        .nav-link .icon { margin-right: 12px; width: 20px; height: 20px; }
        .sidebar-footer { margin-top: auto; }
        .admin-info { display: flex; align-items: center; padding: 15px; background-color: #34495e; border-radius: 6px; margin-bottom: 15px; }
        .admin-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: #667eea; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px; }
        .admin-name { font-weight: 600; font-size: 15px; }
        .admin-role { font-size: 13px; color: #bdc3c7; }
        .logout-btn { background-color: #e74c3c; color: white; width: 100%; }
        .logout-btn:hover { background-color: #c0392b; }

        .main-content { flex-grow: 1; padding: 25px; background-color: #f4f7f9; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .page-title { font-size: 28px; color: #2c3e50; margin: 0; }
        .btn-outline { background-color: transparent; color: #667eea; border: 1px solid #667eea; }
        .btn-outline:hover { background-color: #667eea; color: white; }
        .btn-success { background-color: #2ecc71; color: white; }
        .btn-success:hover { background-color: #27ae60; }
        .btn-danger { background-color: #e74c3c; color: white; }
        .btn-danger:hover { background-color: #c0392b; }
        .btn-info { background-color: #3498db; color: white; }
        .btn-info:hover { background-color: #2980b9; }
        .btn-sm { padding: 8px 12px; font-size: 14px; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .stat-title { font-size: 16px; color: #555; }
        .stat-icon svg { width: 28px; height: 28px; }
        .stat-icon.users { color: #3498db; }
        .stat-icon.approved { color: #2ecc71; }
        .stat-icon.pending { color: #f39c12; }
        .stat-icon.rejected { color: #e74c3c; }
        .stat-value { font-size: 32px; font-weight: 600; color: #2c3e50; margin-bottom: 5px; }
        .stat-description { font-size: 14px; color: #7f8c8d; }

        .control-panel, .bulk-deposit, .search-bar, .user-list, .announcement-form, .announcement-list-container {
            background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px;
        }
        .panel-header { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .panel-title { font-size: 20px; color: #2c3e50; margin: 0; }
        .transfer-status { display: flex; align-items: center; margin-bottom: 20px; }
        .status-indicator { display: flex; align-items: center; }
        .indicator { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        .indicator.on { background-color: #2ecc71; box-shadow: 0 0 8px #2ecc71; }
        .indicator.off { background-color: #e74c3c; box-shadow: 0 0 8px #e74c3c; }
        #transfer-status-text { font-weight: 500; }
        .control-buttons .btn { margin-right: 10px; }
        .search-form { display: flex; gap: 10px; }
        .search-form input { flex-grow: 1; }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; font-weight: 600; color: #555; }
        td { font-size: 15px; }
        .user-image { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; cursor: pointer; border: 1px solid #ddd; }
        .user-status { padding: 4px 8px; border-radius: 20px; font-size: 12px; font-weight: 500; text-transform: capitalize; }
        .status-pending { background-color: #fff3e0; color: #f39c12; }
        .status-approved { background-color: #e8f5e9; color: #2ecc71; }
        .status-rejected { background-color: #ffebee; color: #e74c3c; }
        .action-buttons .btn { margin-right: 5px; margin-bottom: 5px; }
        .pagination { display: flex; justify-content: center; align-items: center; margin-top: 20px; }
        .page-item { padding: 8px 12px; margin: 0 3px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; user-select: none; }
        .page-item:hover { background-color: #f0f0f0; }
        .page-item.active { background-color: #667eea; color: white; border-color: #667eea; }
        .page-item.disabled { color: #aaa; cursor: not-allowed; }

        textarea { width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; font-size: 15px; }
        .announcement-item { border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .announcement-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .announcement-image { max-width: 100%; height: auto; border-radius: 6px; margin-bottom: 10px; }
        .announcement-content { color: #555; margin-bottom: 10px; line-height: 1.6; }
        .announcement-meta { font-size: 13px; color: #7f8c8d; display: flex; justify-content: space-between; align-items: center; }
        .announcement-interactions .interaction-item { margin-left: 15px; }
        .announcement-interactions .interaction-item i { margin-right: 4px; }
        .announcement-actions { margin-top: 10px; }

        /* Modal Styles */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5);
            align-items: center; justify-content: center;
        }
        .modal-content {
            background-color: #fff; margin: auto; padding: 25px;
            border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            width: 90%; max-width: 500px;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .modal-title { font-size: 20px; margin: 0; color: #2c3e50; }
        .close-modal { font-size: 28px; color: #aaa; background: none; border: none; cursor: pointer; }
        .close-modal:hover { color: #333; }
        .modal-footer { margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee; text-align: right; }
        .modal-footer .btn { margin-left: 10px; }
        .image-preview { max-width: 100%; max-height: 70vh; display: block; margin: 0 auto; border-radius: 6px; }
        .user-id { color: #667eea; font-weight: bold; }

        /* Responsive */
        @media (max-width: 991px) {
            .sidebar {
                position: fixed;
                left: 0; top: 0; bottom: 0;
                transform: translateX(-100%);
                z-index: 1001; /* Ensure sidebar is above main content overlay */
                box-shadow: 5px 0 15px rgba(0,0,0,0.1);
            }
            .main-content .header .menu-toggle { display: block; } /* Show hamburger on mobile */
            .sidebar-header .menu-toggle { display: block; } /* Show close on mobile sidebar */
        }
        @media (min-width: 992px) {
            .main-content .header .menu-toggle { display: none; } /* Hide hamburger on desktop */
            .sidebar-header .menu-toggle { display: none; } /* Hide close on desktop sidebar */
        }
        .mt-4 { margin-top: 1.5rem !important; }
        .mb-4 { margin-bottom: 1.5rem !important; }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div class="login-container" id="login-container">
        <div class="login-box">
            <div class="login-logo">
                <img src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="OPPER Logo">
            </div>
            <h2 class="login-title">Admin Dashboard</h2>
            <div class="form-group">
                <label for="admin-email">Email Address</label>
                <input type="email" id="admin-email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label for="admin-pin">PIN</label>
                <input type="password" id="admin-pin" placeholder="Enter your PIN" required>
            </div>
            <button class="btn btn-primary btn-block" onclick="adminLogin()">
                <span>Login</span>
                <i class="fas fa-arrow-right icon"></i>
            </button>
            <div class="message message-error mt-4" id="login-error" style="display:none;"></div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard hidden" id="dashboard-main">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="OPPER Logo">
                    <h2>OPPER Admin</h2>
                </div>
                <button class="menu-toggle" id="close-sidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link active" onclick="showTab('dashboard-tab')">
                        <i class="fas fa-tachometer-alt icon"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#users" class="nav-link" onclick="showTab('users-tab')">
                        <i class="fas fa-users icon"></i> Users
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#kyc" class="nav-link" onclick="showTab('kyc-tab')">
                        <i class="fas fa-user-check icon"></i> KYC Verification
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#transactions" class="nav-link" onclick="showTab('transactions-tab')">
                        <i class="fas fa-exchange-alt icon"></i> Transactions
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#announcements" class="nav-link" onclick="showTab('announcements-tab')">
                        <i class="fas fa-bullhorn icon"></i> Announcements
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#settings" class="nav-link" onclick="showTab('settings-tab')">
                        <i class="fas fa-cog icon"></i> Settings
                    </a>
                </li>
            </ul>
            <div class="sidebar-footer">
                <div class="admin-info">
                    <div class="admin-avatar">A</div>
                    <div class="admin-details">
                        <div class="admin-name">Admin User</div>
                        <div class="admin-role">Super Administrator</div>
                    </div>
                </div>
                <button class="btn logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt icon"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <button class="menu-toggle" id="open-sidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title" id="main-page-title">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="refreshData()">
                        <i class="fas fa-sync-alt icon"></i> Refresh Data
                    </button>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Total Users</div>
                            <div class="stat-icon users"><i class="fas fa-users"></i></div>
                        </div>
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-description">Total registered users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Approved Users</div>
                            <div class="stat-icon approved"><i class="fas fa-user-check"></i></div>
                        </div>
                        <div class="stat-value" id="approved-users">0</div>
                        <div class="stat-description">KYC verified users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Pending KYC</div>
                            <div class="stat-icon pending"><i class="fas fa-user-clock"></i></div>
                        </div>
                        <div class="stat-value" id="pending-users">0</div>
                        <div class="stat-description">Awaiting verification</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Rejected KYC</div>
                            <div class="stat-icon rejected"><i class="fas fa-user-times"></i></div>
                        </div>
                        <div class="stat-value" id="rejected-users">0</div>
                        <div class="stat-description">Failed verification</div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="panel-header"><h2 class="panel-title">System Controls</h2></div>
                    <div class="transfer-status">
                        <div class="status-indicator">
                            <div class="indicator" id="transfer-indicator"></div>
                            <span id="transfer-status-text">Loading status...</span>
                        </div>
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-success" onclick="enableTransfers()"><i class="fas fa-toggle-on icon"></i>Enable Transfers</button>
                        <button class="btn btn-danger" onclick="disableTransfers()"><i class="fas fa-toggle-off icon"></i>Disable Transfers</button>
                    </div>
                </div>

                <div class="bulk-deposit">
                    <div class="panel-header"><h2 class="panel-title">Bulk Deposit</h2></div>
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <input type="number" id="bulk-amount" placeholder="Enter Amount (Ks)" min="1" style="flex-grow:1;">
                        <button class="btn btn-primary" onclick="bulkDeposit()"><i class="fas fa-coins icon"></i>Deposit to All Approved</button>
                    </div>
                    <div class="message message-success mt-4" id="bulk-success" style="display:none;"></div>
                    <div class="message message-error mt-4" id="bulk-error" style="display:none;"></div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <div class="search-bar">
                    <div class="panel-header"><h2 class="panel-title">Search Users</h2></div>
                    <div class="search-form">
                        <input type="text" id="search-input" placeholder="Search by User ID, Name or Phone Number">
                        <button class="btn btn-primary" onclick="searchUser()"><i class="fas fa-search icon"></i>Search</button>
                    </div>
                </div>
                <div class="user-list">
                    <div class="panel-header"><h2 class="panel-title">All Users</h2></div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>User ID</th><th>Name</th><th>Phone</th><th>Balance (Ks)</th><th>Status</th><th>Passport Img</th><th>Selfie Img</th><th>Actions</th></tr></thead>
                            <tbody id="user-table"></tbody>
                        </table>
                    </div>
                    <div class="pagination" id="pagination"></div>
                </div>
            </div>

            <!-- KYC Tab -->
            <div id="kyc-tab" class="tab-content">
                <div class="user-list">
                    <div class="panel-header"><h2 class="panel-title">Pending KYC Verifications</h2></div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>User ID</th><th>Name</th><th>Phone</th><th>Passport Img</th><th>Selfie Img</th><th>Submitted At</th><th>Actions</th></tr></thead>
                            <tbody id="kyc-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions-tab" class="tab-content">
                <div class="user-list">
                    <div class="panel-header"><h2 class="panel-title">Recent Transactions</h2></div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>ID</th><th>From</th><th>To</th><th>Amount (Ks)</th><th>Note</th><th>Date</th></tr></thead>
                            <tbody id="transactions-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Announcements Tab -->
            <div id="announcements-tab" class="tab-content">
                <div class="announcement-form">
                    <div class="panel-header"><h2 class="panel-title">Create Announcement</h2></div>
                    <div class="form-group">
                        <label for="announcement-title">Title</label>
                        <input type="text" id="announcement-title" placeholder="Announcement Title">
                    </div>
                    <div class="form-group">
                        <label for="announcement-content">Content</label>
                        <textarea id="announcement-content" placeholder="Announcement Details..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="announcement-image">Image URL (Optional)</label>
                        <input type="url" id="announcement-image" placeholder="https://example.com/image.png">
                    </div>
                    <button class="btn btn-primary" onclick="postAnnouncement()">Post Announcement</button>
                    <div class="message message-success mt-4" id="announcement-success" style="display:none;"></div>
                    <div class="message message-error mt-4" id="announcement-error" style="display:none;"></div>
                </div>

                <div class="announcement-list-container mt-4">
                    <div class="panel-header"><h2 class="panel-title">Posted Announcements</h2></div>
                    <div id="announcement-list">
                        <p>No announcements yet.</p>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="control-panel">
                    <div class="panel-header"><h2 class="panel-title">System Settings</h2></div>
                    <div class="form-group">
                        <button class="btn btn-danger" onclick="resetAllPasswords()">
                            <i class="fas fa-undo icon"></i> Reset All User Passwords (to '123456')
                        </button>
                        <p style="font-size: 13px; color: #7f8c8d; margin-top: 10px;">Warning: This action is irreversible and will reset passwords for ALL users in the 'auth_users' table.</p>
                    </div>
                     <div class="form-group mt-4">
                        <label for="admin-api-key">Admin API Key (for external tools)</label>
                        <input type="text" id="admin-api-key" readonly style="background-color: #e9ecef; cursor: not-allowed;">
                        <button class="btn btn-outline" onclick="generateApiKey()" style="margin-top: 8px;">Generate/Refresh Key</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div class="modal" id="image-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Image Preview</h2>
                <button class="close-modal" onclick="closeModal('image-modal')">&times;</button>
            </div>
            <div class="modal-body" style="text-align:center;"><img src="/placeholder.svg?width=400&height=300" alt="Preview" class="image-preview" id="preview-image"></div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('image-modal')">Close</button></div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal" id="deposit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Deposit Funds</h2>
                <button class="close-modal" onclick="closeModal('deposit-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p class="mb-4">Depositing to: <strong id="deposit-user-id" class="user-id"></strong></p>
                <div class="form-group">
                    <label for="deposit-amount">Amount (Ks)</label>
                    <input type="number" id="deposit-amount" placeholder="Enter Amount" min="1">
                </div>
                <div class="message message-error mt-4" id="deposit-error" style="display:none;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('deposit-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmDeposit()">Confirm Deposit</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const supabaseUrl = 'https://vtsczzlnhsrgnbkfyizi.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0c2N6emxuaHNyZ25ia2Z5aXppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2ODYwODMsImV4cCI6MjA1ODI2MjA4M30.LjP2g0WXgg6FVTM5gPIkf_qlXakkj8Hf5xzXVsx7y68'; // ANON KEY
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // --- SECURITY WARNING ---
        // This admin panel uses the public ANON key. For this to work effectively and securely,
        // you MUST ensure that your Row Level Security (RLS) policies on Supabase tables
        // are configured to allow the 'anon' role (or a specific admin role if you implement one)
        // to perform necessary read/write operations.
        // Using ANON key for admin operations in the browser is generally NOT recommended for production.
        // A more secure approach involves a backend service using the SERVICE_ROLE key.
        // The RPC functions (admin_deposit, admin_bulk_deposit) are granted to 'anon' for this setup.
        
        const ADMIN_EMAIL = 'crakb68@gmail.com'; // Hardcoded admin credentials
        const ADMIN_PIN = '155872';

        let currentUserIdForModal = null;
        let currentPage = 1;
        let itemsPerPage = 10;
        let userStats = { total: 0, approved: 0, pending: 0, rejected: 0 };
        let adminLoggedIn = false;

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dashboard-main').classList.add('hidden');
            document.getElementById('login-container').classList.remove('hidden');

            document.getElementById('open-sidebar').addEventListener('click', () => document.getElementById('sidebar').classList.add('active'));
            document.getElementById('close-sidebar').addEventListener('click', () => document.getElementById('sidebar').classList.remove('active'));
            
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = link.getAttribute('onclick').match(/'([^']+)'/)[1];
                    showTab(tabId);
                    if (window.innerWidth < 992) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
            loadAdminApiKey();
        });

        function adminLogin() {
            const email = document.getElementById('admin-email').value;
            const pin = document.getElementById('admin-pin').value;
            const errorMessageEl = document.getElementById('login-error');
            errorMessageEl.style.display = 'none';

            if (email === ADMIN_EMAIL && pin === ADMIN_PIN) {
                adminLoggedIn = true;
                document.getElementById('login-container').classList.add('hidden');
                document.getElementById('dashboard-main').classList.remove('hidden');
                initializeDashboard();
            } else {
                errorMessageEl.textContent = 'Invalid email or PIN. Please try again.';
                errorMessageEl.style.display = 'block';
            }
        }

        function logout() {
            adminLoggedIn = false;
            document.getElementById('login-container').classList.remove('hidden');
            document.getElementById('dashboard-main').classList.add('hidden');
            document.getElementById('admin-email').value = '';
            document.getElementById('admin-pin').value = '';
            document.getElementById('login-error').style.display = 'none';
        }

        async function initializeDashboard() {
            if (!adminLoggedIn) return;
            showTab('dashboard-tab'); // Default to dashboard tab
            try {
                await Promise.all([
                    loadUserStats(), loadUsers(), loadKycRequests(),
                    loadTransactions(), checkTransferStatus(), loadAnnouncementsAdminView()
                ]);
            } catch (error) {
                console.error('Dashboard Initialization Error:', error.message);
                alert(`Error initializing dashboard: ${error.message}. Check RLS policies if data is not loading.`);
            }
        }

        async function refreshData() {
            if (!adminLoggedIn) return;
            try {
                await initializeDashboard();
                alert('Data refreshed successfully!');
            } catch (error) {
                console.error('Refresh Data Error:', error.message);
                alert(`Error refreshing data: ${error.message}`);
            }
        }

        async function loadUserStats() {
            if (!adminLoggedIn) return;
            try {
                const { data, error, count } = await supabase.from('users').select('passport_status', { count: 'exact' });
                if (error) throw new Error(`Fetch Users Stats Error: ${error.message}`);
                userStats = {
                    total: count || 0,
                    approved: data.filter(u => u.passport_status === 'approved').length,
                    pending: data.filter(u => u.passport_status === 'pending').length,
                    rejected: data.filter(u => u.passport_status === 'rejected').length
                };
                document.getElementById('total-users').textContent = userStats.total;
                document.getElementById('approved-users').textContent = userStats.approved;
                document.getElementById('pending-users').textContent = userStats.pending;
                document.getElementById('rejected-users').textContent = userStats.rejected;
            } catch (error) { console.error('Load User Stats Error:', error.message); throw error; }
        }

        async function loadUsers(searchQuery = '') {
            if (!adminLoggedIn) return;
            try {
                let query = supabase.from('users').select('user_id, name, phone, balance, passport_status, passport_image, selfie_image, created_at', { count: 'exact' });
                if (searchQuery) {
                    query = query.or(`user_id.ilike.%${searchQuery}%,name.ilike.%${searchQuery}%,phone.ilike.%${searchQuery}%`);
                }
                const { data: users, error, count } = await query
                    .range((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage - 1)
                    .order('created_at', { ascending: false });

                if (error) throw new Error(`Fetch Users Error: ${error.message}`);
                
                const userTable = document.getElementById('user-table');
                userTable.innerHTML = '';
                if (!users || users.length === 0) {
                    userTable.innerHTML = `<tr><td colspan="8" style="text-align:center; padding: 20px;">No users found.</td></tr>`;
                    updatePagination(0);
                    return;
                }

                users.forEach(user => {
                    const row = userTable.insertRow();
                    let statusClass = '';
                    if (user.passport_status === 'pending') statusClass = 'status-pending';
                    else if (user.passport_status === 'approved') statusClass = 'status-approved';
                    else if (user.passport_status === 'rejected') statusClass = 'status-rejected';
                    
                    row.innerHTML = `
                        <td class="user-id" title="${user.user_id}">${user.user_id.substring(0,8)}...</td>
                        <td>${user.name || 'N/A'}</td>
                        <td class="user-phone">${user.phone || 'N/A'}</td>
                        <td class="user-balance">${(user.balance || 0).toLocaleString()}</td>
                        <td><span class="user-status ${statusClass}">${user.passport_status || 'N/A'}</span></td>
                        <td><img src="${user.passport_image || '/placeholder.svg?width=40&height=40&text=NoImg'}" alt="Passport" class="user-image" onerror="this.src='/placeholder.svg?width=40&height=40&text=Error'" onclick="showImagePreview('${user.passport_image || '/placeholder.svg?width=300&height=200&text=No+Image'}')"></td>
                        <td><img src="${user.selfie_image || '/placeholder.svg?width=40&height=40&text=NoImg'}" alt="Selfie" class="user-image" onerror="this.src='/placeholder.svg?width=40&height=40&text=Error'" onclick="showImagePreview('${user.selfie_image || '/placeholder.svg?width=300&height=200&text=No+Image'}')"></td>
                        <td class="action-buttons">
                            ${user.passport_status !== 'approved' ? `<button class="btn btn-success btn-sm" onclick="updateStatus('${user.user_id}', 'approved')">Approve</button>` : ''}
                            ${user.passport_status !== 'rejected' ? `<button class="btn btn-danger btn-sm" onclick="updateStatus('${user.user_id}', 'rejected')">Reject</button>` : ''}
                            <button class="btn btn-info btn-sm" onclick="showDepositModal('${user.user_id}')">Deposit</button>
                        </td>
                    `;
                });
                updatePagination(count || 0);
            } catch (error) { console.error('Load Users Error:', error.message); throw error; }
        }

        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';
            if (totalPages <= 1) return;

            const createPageItem = (text, page, isDisabled = false, isActive = false) => {
                const item = document.createElement('div');
                item.className = `page-item ${isDisabled ? 'disabled' : ''} ${isActive ? 'active' : ''}`;
                item.innerHTML = text;
                if (!isDisabled) item.onclick = () => { currentPage = page; loadUsers(document.getElementById('search-input').value.trim()); };
                return item;
            };

            paginationElement.appendChild(createPageItem('&laquo;', currentPage - 1, currentPage === 1));
            
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            if (currentPage <= 3) { endPage = Math.min(5, totalPages); }
            if (currentPage >= totalPages - 2) { startPage = Math.max(1, totalPages - 4); }


            if (startPage > 1) {
                paginationElement.appendChild(createPageItem(1, 1));
                if (startPage > 2) paginationElement.appendChild(createPageItem('...', currentPage, true));
            }

            for (let i = startPage; i <= endPage; i++) {
                 paginationElement.appendChild(createPageItem(i, i, false, i === currentPage));
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) paginationElement.appendChild(createPageItem('...', currentPage, true));
                paginationElement.appendChild(createPageItem(totalPages, totalPages));
            }
            
            paginationElement.appendChild(createPageItem('&raquo;', currentPage + 1, currentPage === totalPages));
        }
        
        async function loadKycRequests() {
            if (!adminLoggedIn) return;
            try {
                const { data: pendingUsers, error } = await supabase.from('users').select('user_id, name, phone, passport_image, selfie_image, submitted_at').eq('passport_status', 'pending').order('submitted_at', { ascending: true });
                if (error) throw new Error(`Fetch KYC Requests Error: ${error.message}`);
                const kycTable = document.getElementById('kyc-table');
                kycTable.innerHTML = '';
                if (!pendingUsers || pendingUsers.length === 0) {
                    kycTable.innerHTML = `<tr><td colspan="7" style="text-align:center; padding: 20px;">No pending KYC requests.</td></tr>`;
                    return;
                }
                pendingUsers.forEach(user => {
                    const row = kycTable.insertRow();
                    const submittedDate = user.submitted_at ? new Date(user.submitted_at).toLocaleString() : 'N/A';
                    row.innerHTML = `
                        <td class="user-id" title="${user.user_id}">${user.user_id.substring(0,8)}...</td>
                        <td>${user.name || 'N/A'}</td>
                        <td class="user-phone">${user.phone || 'N/A'}</td>
                        <td><img src="${user.passport_image || '/placeholder.svg?width=40&height=40&text=NoImg'}" alt="Passport" class="user-image" onerror="this.src='/placeholder.svg?width=40&height=40&text=Error'" onclick="showImagePreview('${user.passport_image || '/placeholder.svg?width=300&height=200&text=No+Image'}')"></td>
                        <td><img src="${user.selfie_image || '/placeholder.svg?width=40&height=40&text=NoImg'}" alt="Selfie" class="user-image" onerror="this.src='/placeholder.svg?width=40&height=40&text=Error'" onclick="showImagePreview('${user.selfie_image || '/placeholder.svg?width=300&height=200&text=No+Image'}')"></td>
                        <td>${submittedDate}</td>
                        <td class="action-buttons">
                            <button class="btn btn-success btn-sm" onclick="updateStatus('${user.user_id}', 'approved')">Approve</button>
                            <button class="btn btn-danger btn-sm" onclick="updateStatus('${user.user_id}', 'rejected')">Reject</button>
                        </td>
                    `;
                });
            } catch (error) { console.error('Load KYC Requests Error:', error.message); throw error; }
        }

        async function loadTransactions() {
            if (!adminLoggedIn) return;
            try {
                const { data: transactions, error } = await supabase.from('transactions').select('*').order('created_at', { ascending: false }).limit(100);
                if (error) throw new Error(`Fetch Transactions Error: ${error.message}`);
                const transactionsTable = document.getElementById('transactions-table');
                transactionsTable.innerHTML = '';
                 if (!transactions || transactions.length === 0) {
                    transactionsTable.innerHTML = `<tr><td colspan="6" style="text-align:center; padding: 20px;">No transactions found.</td></tr>`;
                    return;
                }
                transactions.forEach(tx => {
                    const row = transactionsTable.insertRow();
                    const date = new Date(tx.created_at).toLocaleString();
                    row.innerHTML = `
                        <td>${tx.id}</td>
                        <td>${tx.from_phone || 'N/A'} (${tx.from_name || 'User'})</td>
                        <td>${tx.to_phone || 'N/A'} (${tx.to_name || 'User'})</td>
                        <td class="user-balance">${(tx.amount || 0).toLocaleString()}</td>
                        <td>${tx.note || 'N/A'}</td>
                        <td>${date}</td>
                    `;
                });
            } catch (error) { console.error('Load Transactions Error:', error.message); throw error; }
        }

        async function checkTransferStatus() {
            if (!adminLoggedIn) return;
            try {
                const { data, error } = await supabase.from('settings').select('allow_transfers').eq('id', 1).single();
                if (error) {
                    // If settings table is empty, insert default
                    if (error.code === 'PGRST116') { // Single row not found
                        await supabase.from('settings').insert({id: 1, allow_transfers: true});
                        await checkTransferStatus(); // Retry
                        return;
                    }
                    throw new Error(`Fetch Settings Error: ${error.message}`);
                }
                const indicator = document.getElementById('transfer-indicator');
                const statusText = document.getElementById('transfer-status-text');
                if (data.allow_transfers) {
                    indicator.className = 'indicator on';
                    statusText.textContent = 'Transfers are ENABLED';
                    statusText.style.color = 'var(--success, #2ecc71)';
                } else {
                    indicator.className = 'indicator off';
                    statusText.textContent = 'Transfers are DISABLED';
                    statusText.style.color = 'var(--danger, #e74c3c)';
                }
            } catch (error) { console.error('Check Transfer Status Error:', error.message); throw error; }
        }

        async function searchUser() {
            const searchQuery = document.getElementById('search-input').value.trim();
            currentPage = 1;
            await loadUsers(searchQuery);
        }

        async function updateStatus(userId, status) {
            if (!adminLoggedIn) return;
            if (!confirm(`Are you sure you want to set KYC status to "${status}" for user ${userId}?`)) return;
            try {
                const { error } = await supabase.from('users').update({ passport_status: status }).eq('user_id', userId);
                if (error) throw new Error(`Update Status Error: ${error.message}`);
                await Promise.all([loadUserStats(), loadUsers(), loadKycRequests()]); // Refresh relevant data
                alert(`User ${userId} KYC status updated to ${status}.`);
            } catch (error) { console.error('Update Status Error:', error.message); alert(`Error updating status: ${error.message}`); }
        }

        function showImagePreview(imageUrl) {
            document.getElementById('preview-image').src = imageUrl || '/placeholder.svg?width=400&height=300&text=No+Image';
            document.getElementById('image-modal').style.display = 'flex';
        }

        function showDepositModal(userId) {
            currentUserIdForModal = userId;
            document.getElementById('deposit-user-id').textContent = userId;
            document.getElementById('deposit-amount').value = '';
            document.getElementById('deposit-error').style.display = 'none';
            document.getElementById('deposit-modal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        async function confirmDeposit() {
            if (!adminLoggedIn) return;
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const errorElement = document.getElementById('deposit-error');
            errorElement.style.display = 'none';
            if (isNaN(amount) || amount <= 0) {
                errorElement.textContent = 'Please enter a valid positive amount.';
                errorElement.style.display = 'block';
                return;
            }
            try {
                // Calling the RPC function created in 04-admin-functions.sql
                const { error: rpcError } = await supabase.rpc('admin_deposit', {
                    target_user_id_input: currentUserIdForModal,
                    deposit_amount_input: amount
                });
                if (rpcError) throw rpcError;

                closeModal('deposit-modal');
                await loadUsers(); // Refresh user list to show updated balance
                await loadUserStats(); // Refresh stats
                alert(`Successfully deposited ${amount.toLocaleString()} Ks to user ${currentUserIdForModal}.`);
            } catch (error) {
                console.error('Deposit Error:', error.message);
                errorElement.textContent = `Error: ${error.message}`;
                errorElement.style.display = 'block';
            }
        }

        async function bulkDeposit() {
            if (!adminLoggedIn) return;
            const amount = parseInt(document.getElementById('bulk-amount').value);
            const successMessageEl = document.getElementById('bulk-success');
            const errorMessageEl = document.getElementById('bulk-error');
            successMessageEl.style.display = 'none'; errorMessageEl.style.display = 'none';

            if (isNaN(amount) || amount <= 0) {
                errorMessageEl.textContent = 'Please enter a valid positive amount.';
                errorMessageEl.style.display = 'block';
                return;
            }
            if (!confirm(`Are you sure you want to deposit ${amount.toLocaleString()} Ks to ALL approved users?`)) return;

            try {
                 // Calling the RPC function created in 04-admin-functions.sql
                const { error: rpcError } = await supabase.rpc('admin_bulk_deposit', { deposit_amount_input: amount });
                if (rpcError) throw rpcError;
                
                successMessageEl.textContent = `Successfully initiated deposit of ${amount.toLocaleString()} Ks to all approved accounts. Balances will update shortly.`;
                successMessageEl.style.display = 'block';
                await loadUsers(); // Refresh user list
                await loadUserStats(); // Refresh stats
            } catch (error) {
                console.error('Bulk Deposit Error:', error.message);
                errorMessageEl.textContent = `Error: ${error.message}`;
                errorMessageEl.style.display = 'block';
            }
        }

        async function enableTransfers() {
            if (!adminLoggedIn) return;
            if (!confirm('Are you sure you want to ENABLE all transfers?')) return;
            try {
                const { error } = await supabase.from('settings').update({ allow_transfers: true }).eq('id', 1);
                if (error) throw new Error(`Enable Transfers Error: ${error.message}`);
                await checkTransferStatus();
                alert('Transfers have been ENABLED successfully.');
            } catch (error) { console.error('Enable Transfers Error:', error.message); alert(`Error enabling transfers: ${error.message}`); }
        }

        async function disableTransfers() {
            if (!adminLoggedIn) return;
            if (!confirm('Are you sure you want to DISABLE all transfers?')) return;
            try {
                const { error } = await supabase.from('settings').update({ allow_transfers: false }).eq('id', 1);
                if (error) throw new Error(`Disable Transfers Error: ${error.message}`);
                await checkTransferStatus();
                alert('Transfers have been DISABLED successfully.');
            } catch (error) { console.error('Disable Transfers Error:', error.message); alert(`Error disabling transfers: ${error.message}`); }
        }
        
        async function resetAllPasswords() {
            if (!adminLoggedIn) return;
            if (!confirm('DANGER: Are you sure you want to reset ALL user passwords in "auth_users" table to "123456"? This action cannot be undone and affects all users.')) return;
            
            try {
                // This is a client-side loop, which is not ideal for bulk updates.
                // A backend function or a more complex SQL query would be better for performance and atomicity.
                // However, for this client-side example:
                const { data: users, error: fetchError } = await supabase.from('auth_users').select('user_id');
                if (fetchError) throw new Error(`Fetch users for password reset error: ${fetchError.message}`);

                if (!users || users.length === 0) {
                    alert('No users found to reset passwords.');
                    return;
                }

                let successCount = 0;
                let failCount = 0;

                for (const user of users) {
                    const { error: updateError } = await supabase
                        .from('auth_users')
                        .update({ password: '123456' }) // Store hashed passwords in a real app!
                        .eq('user_id', user.user_id);
                    if (updateError) {
                        console.error(`Failed to reset password for user ${user.user_id}: ${updateError.message}`);
                        failCount++;
                    } else {
                        successCount++;
                    }
                }
                alert(`Password reset complete. Success: ${successCount}, Failed: ${failCount}. Users need to be informed of the new password.`);

            } catch (error) {
                console.error('Reset All Passwords Error:', error.message);
                alert(`Error resetting passwords: ${error.message}`);
            }
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            const activeTab = document.getElementById(tabId);
            if (activeTab) activeTab.classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.nav-link[onclick="showTab('${tabId}')"]`);
            if (activeLink) {
                activeLink.classList.add('active');
                document.getElementById('main-page-title').textContent = activeLink.textContent.trim();
            }

            // Load data for specific tabs when they are shown
            if (tabId === 'kyc-tab') loadKycRequests();
            else if (tabId === 'transactions-tab') loadTransactions();
            else if (tabId === 'announcements-tab') loadAnnouncementsAdminView();
            else if (tabId === 'users-tab') { currentPage = 1; loadUsers(); } // Reset to page 1 for users tab
            else if (tabId === 'dashboard-tab') loadUserStats(); // Refresh stats for dashboard
        }

        async function postAnnouncement() {
            if (!adminLoggedIn) return;
            const title = document.getElementById('announcement-title').value.trim();
            const content = document.getElementById('announcement-content').value.trim();
            const imageUrl = document.getElementById('announcement-image').value.trim();
            const successMessageEl = document.getElementById('announcement-success');
            const errorMessageEl = document.getElementById('announcement-error');
            successMessageEl.style.display = 'none'; errorMessageEl.style.display = 'none';

            if (!title || !content) {
                errorMessageEl.textContent = 'Title and content are required.';
                errorMessageEl.style.display = 'block';
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('announcements')
                    .insert([{ title, content, image_url: imageUrl || null, likes: 0, comments_count: 0, views: 0 }]); // Initialize counts
                if (error) throw error;

                successMessageEl.textContent = 'Announcement posted successfully!';
                successMessageEl.style.display = 'block';
                document.getElementById('announcement-title').value = '';
                document.getElementById('announcement-content').value = '';
                document.getElementById('announcement-image').value = '';
                loadAnnouncementsAdminView(); // Refresh the list
            } catch (error) {
                console.error('Post Announcement Error:', error);
                errorMessageEl.textContent = `Error posting announcement: ${error.message}`;
                errorMessageEl.style.display = 'block';
            }
        }

        async function loadAnnouncementsAdminView() { // Renamed to avoid conflict if user-side has similar name
            if (!adminLoggedIn) return;
            try {
                const { data, error } = await supabase
                    .from('announcements')
                    .select('*')
                    .order('created_at', { ascending: false });
                if (error) throw error;

                const listElement = document.getElementById('announcement-list');
                listElement.innerHTML = '';

                if (!data || data.length === 0) {
                    listElement.innerHTML = '<p>No announcements posted yet.</p>';
                    return;
                }

                data.forEach(ann => {
                    const item = document.createElement('div');
                    item.className = 'announcement-item';
                    item.innerHTML = `
                        <h3 class="announcement-title">${ann.title}</h3>
                        ${ann.image_url ? `<img src="${ann.image_url}" alt="${ann.title}" class="announcement-image" style="max-width:200px; height:auto; border-radius:4px; margin-bottom:10px;">` : ''}
                        <p class="announcement-content">${ann.content.replace(/\n/g, '<br>')}</p>
                        <div class="announcement-meta">
                            <span>Posted on: ${new Date(ann.created_at).toLocaleString()}</span>
                            <div class="announcement-interactions">
                                <span class="interaction-item"><i class="fas fa-thumbs-up"></i> ${ann.likes || 0}</span>
                                <span class="interaction-item"><i class="fas fa-comment"></i> ${ann.comments_count || 0}</span>
                                <span class="interaction-item"><i class="fas fa-eye"></i> ${ann.views || 0}</span>
                            </div>
                        </div>
                        <div class="announcement-actions">
                             <button class="btn btn-danger btn-sm" onclick="deleteAnnouncement(${ann.id})">Delete</button>
                        </div>
                    `;
                    listElement.appendChild(item);
                });
            } catch (error) {
                console.error('Load Announcements Error (Admin):', error);
                document.getElementById('announcement-list').innerHTML = '<p>Error loading announcements.</p>';
            }
        }
        
        async function deleteAnnouncement(id) {
            if (!adminLoggedIn) return;
            if (!confirm('Are you sure you want to delete this announcement?')) return;
            try {
                const { error } = await supabase.from('announcements').delete().eq('id', id);
                if (error) throw error;
                alert('Announcement deleted successfully.');
                loadAnnouncementsAdminView(); // Refresh the list
            } catch (error) {
                console.error('Delete Announcement Error:', error);
                alert(`Error deleting announcement: ${error.message}`);
            }
        }

        function generateApiKey() {
            // Simple client-side key generation for display. Real API keys should be managed securely.
            const key = 'OPPER_ADMIN_KEY_' + Array.from(crypto.getRandomValues(new Uint8Array(16))).map(b => b.toString(16).padStart(2, '0')).join('');
            localStorage.setItem('adminApiKey', key); // Store in local storage for persistence in this example
            document.getElementById('admin-api-key').value = key;
            alert('New API Key generated and saved locally (for this browser session). This is for illustrative purposes; real API keys need secure server-side management.');
        }

        function loadAdminApiKey() {
            const key = localStorage.getItem('adminApiKey');
            if (key) {
                document.getElementById('admin-api-key').value = key;
            } else {
                document.getElementById('admin-api-key').value = 'No key generated yet.';
            }
        }

    </script>
</body>
</html>

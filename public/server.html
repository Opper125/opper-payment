<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KPAY+ Admin Dashboard</title>
    <style>
        /* Base Styles */
        :root {
            --primary: #d42628;
            --primary-dark: #b51f21;
            --primary-light: #f15456;
            --secondary: #fcd92b;
            --secondary-dark: #d9bc25;
            --secondary-light: #ffe563;
            --dark-blue: #051441;
            --dark-blue-light: #152654;
            --light: #ffffff;
            --dark: #13111a;
            --gray-light: #e5e7eb;
            --gray: #94a3b8;
            --gray-dark: #334155;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --radius-sm: 0.375rem;
            --radius-md: 0.75rem;
            --radius-lg: 1.25rem;
            --radius-full: 9999px;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 10px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.25);
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            --font-main: 'Pyidaungsu', 'Poppins', sans-serif;
            --font-display: 'Padauk', 'Playfair Display', serif;
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-light));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), var(--secondary-light));
            --gradient-dark: linear-gradient(135deg, var(--dark-blue), var(--dark-blue-light));
            --gradient-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-main);
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--gradient-dark);
            min-height: 100vh;
            padding: 2vw;
            color: var(--light);
            font-size: clamp(14px, 3vw, 16px);
            position: relative;
            overflow-x: hidden;
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-family: var(--font-display);
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        /* Animation and Effects */
        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: var(--primary-light);
            border-radius: 50%;
            opacity: 0.3;
            animation: float linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }

        /* Login Screen */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 20, 65, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .login-box {
            background: var(--gradient-glass);
            padding: clamp(25px, 5vw, 30px);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            width: 90%;
            max-width: 400px;
            animation: loginBoxAppear 0.5s var(--transition-normal);
        }

        @keyframes loginBoxAppear {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .login-box h2 {
            color: var(--primary);
            margin-bottom: 3vh;
            font-size: clamp(1.8rem, 5vw, 2.2rem);
            font-weight: 700;
            text-align: center;
            position: relative;
        }

        .login-box h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--primary);
            border-radius: var(--radius-full);
        }

        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            display: block;
            animation: logoSpin 2s infinite alternate ease-in-out;
        }

        @keyframes logoSpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(20deg); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .login-box input {
            width: 100%;
            padding: clamp(12px, 3vw, 16px);
            margin: 2vh 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.08);
            color: var(--light);
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            outline: none;
            transition: all var(--transition-normal);
        }

        .login-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(212, 38, 40, 0.3);
        }

        .icon-input {
            position: relative;
        }

        .icon-input input {
            padding-left: 45px;
        }

        .icon-input .icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1.2rem;
        }

        .login-box button {
            width: 100%;
            padding: clamp(12px, 3vw, 16px);
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-md);
            color: var(--light);
            font-weight: 700;
            font-size: clamp(1rem, 2.5vw, 1.1rem);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-md);
        }

        .login-box button:hover {
            box-shadow: var(--shadow-lg);
        }

        .login-box button:active {
            transform: translateY(2px);
        }

        .login-box .error-message {
            color: var(--error);
            font-size: clamp(0.8rem, 2.2vw, 0.9rem);
            margin-top: 2vh;
            text-align: center;
            font-weight: 600;
        }

        /* Dashboard Styles */
        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 4vh;
            font-size: clamp(2rem, 6vw, 2.5rem);
            font-weight: 800;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -1.5vh;
            left: 50%;
            transform: translateX(-50%);
            width: clamp(60px, 15vw, 80px);
            height: 3px;
            background: var(--primary);
            border-radius: var(--radius-full);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-container img {
            width: 50px;
            height: 50px;
        }

        .admin-badge {
            background: var(--primary);
            color: var(--light);
            padding: 8px 16px;
            border-radius: var(--radius-full);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-badge i {
            font-size: 1.2rem;
        }

        .card {
            background: var(--gradient-glass);
            padding: clamp(20px, 4vw, 25px);
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card h2 {
            color: var(--light);
            margin-bottom: 20px;
            font-size: clamp(1.4rem, 4vw, 1.6rem);
            font-weight: 600;
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: var(--primary);
            font-size: 1.6rem;
        }

        /* Control Panel Styles */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .control-btn {
            padding: clamp(12px, 3vw, 16px);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            text-align: center;
        }

        .control-btn i {
            font-size: 1.8rem;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .control-btn:active {
            transform: translateY(1px);
        }

        .enable-btn {
            background: linear-gradient(135deg, var(--success), #0d9668);
            color: var(--light);
        }

        .disable-btn {
            background: linear-gradient(135deg, var(--error), #dc2626);
            color: var(--light);
        }

        .system-btn {
            background: linear-gradient(135deg, var(--info), #2563eb);
            color: var(--light);
        }

        /* Deposit Form Styles */
        .deposit-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-field label {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--gray-light);
        }

        input, select {
            padding: clamp(12px, 3vw, 14px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.08);
            color: var(--light);
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            outline: none;
            width: 100%;
            transition: all var(--transition-normal);
        }

        input:focus, select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(212, 38, 40, 0.3);
        }

        button {
            padding: clamp(12px, 3vw, 14px);
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-md);
            color: var(--light);
            font-weight: 600;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-sm);
        }

        button:hover {
            box-shadow: var(--shadow-md);
        }

        button:active {
            transform: translateY(2px);
        }

        /* User List Styles */
        .search-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-form input {
            flex: 1;
        }

        .user-list {
            overflow-x: auto;
        }

        .user-list table {
            width: 100%;
            border-collapse: collapse;
            font-size: clamp(0.85rem, 2.2vw, 0.95rem);
            white-space: nowrap;
        }

        .user-list th, .user-list td {
            padding: clamp(10px, 2vw, 14px);
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-list th {
            color: var(--primary-light);
            font-weight: 600;
            position: sticky;
            top: 0;
            background: var(--dark-blue);
            z-index: 10;
        }

        .user-list tr {
            transition: background-color var(--transition-fast);
        }

        .user-list tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .user-list td img {
            width: clamp(60px, 15vw, 80px);
            height: clamp(60px, 15vw, 80px);
            border-radius: var(--radius-sm);
            cursor: pointer;
            object-fit: cover;
            transition: transform var(--transition-normal);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .user-list td img:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .approve-btn {
            background: var(--success);
            color: var(--light);
        }

        .reject-btn {
            background: var(--error);
            color: var(--light);
        }

        .deposit-btn {
            background: var(--info);
            color: var(--light);
        }

        .user-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: var(--warning);
            color: var(--dark);
        }

        .status-approved {
            background: var(--success);
            color: var(--light);
        }

        .status-rejected {
            background: var(--error);
            color: var(--light);
        }

        /* Dashboard Cards */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--gradient-glass);
            border-radius: var(--radius-md);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--gray-light);
            font-weight: 500;
        }

        .stat-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .icon-users {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
        }

        .icon-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .icon-transactions {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .icon-balance {
            background: rgba(212, 38, 40, 0.2);
            color: var(--primary);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--light);
        }

        .stat-footer {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 20, 65, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: var(--gradient-glass);
            padding: 25px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            width: 90%;
            max-width: 500px;
            animation: modalAppear 0.3s var(--transition-normal);
        }

        @keyframes modalAppear {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            box-shadow: none;
        }

        .modal-close:hover {
            color: var(--light);
            box-shadow: none;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-btn {
            min-width: 100px;
        }

        .btn-cancel {
            background: var(--gray-dark);
        }

        /* Image Preview */
        .img-preview-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .img-preview {
            max-width: 90%;
            max-height: 90%;
            border: 2px solid var(--primary);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
        }

        .img-preview-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: var(--light);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow-md);
        }

        /* Messages */
        .message {
            padding: 15px;
            border-radius: var(--radius-md);
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message i {
            font-size: 1.2rem;
        }

        .message-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .message-error {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .message-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .message-info {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
            border: 1px solid var(--info);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--light);
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* Responsive */
        @media (min-width: 769px) {
            .search-form {
                display: flex;
                flex-direction: row;
            }

            .deposit-form {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-gap: 15px;
            }

            .deposit-form button {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .button-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .user-list td img {
                width: 50px;
                height: 50px;
            }

            .search-form {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .login-box {
                padding: 20px;
                width: 95%;
            }

            .card {
                padding: 15px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .card h2 {
                font-size: 1.3rem;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                align-items: center;
                text-align: center;
            }

            .admin-badge {
                margin-bottom: 15px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Background Particles -->
    <div class="particles-container" id="particles-container"></div>

    <!-- Login Container -->
    <div class="login-container" id="login-container">
        <div class="login-box">
            <img src="https://i.imgur.com/Yt7QeLf.png" alt="KPAY+ Logo" class="login-logo">
            <h2>Admin အကောင့်ဝင်ရန်</h2>
            
            <div class="form-group">
                <div class="icon-input">
                    <i class="fas fa-user icon"></i>
                    <input type="email" id="admin-email" placeholder="အီးမေးလ်ထည့်ပါ" required>
                </div>
            </div>
            
            <div class="form-group">
                <div class="icon-input">
                    <i class="fas fa-lock icon"></i>
                    <input type="password" id="admin-pin" placeholder="PIN ထည့်ပါ" required>
                </div>
            </div>
            
            <button onclick="adminLogin()">
                <i class="fas fa-sign-in-alt" style="margin-right: 8px;"></i> ဝင်ရောက်မည်
            </button>
            
            <p class="error-message hidden" id="login-error"></p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard-container hidden" id="dashboard-container">
        <div class="dashboard-header">
            <div class="logo-container">
                <img src="https://i.imgur.com/Yt7QeLf.png" alt="KPAY+ Logo">
                <h1>KPAY+ Admin Panel</h1>
            </div>
            <div class="admin-badge">
                <i class="fas fa-user-shield"></i>
                <span>Admin</span>
            </div>
        </div>
        
        <!-- Dashboard Stats -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">အသုံးပြုသူအရေအတွက်</div>
                    <div class="stat-icon icon-users"><i class="fas fa-users"></i></div>
                </div>
                <div class="stat-value" id="total-users">0</div>
                <div class="stat-footer">စုစုပေါင်းအသုံးပြုသူ</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">အတည်ပြုရန်စောင့်ဆိုင်းနေသော</div>
                    <div class="stat-icon icon-pending"><i class="fas fa-clock"></i></div>
                </div>
                <div class="stat-value" id="pending-users">0</div>
                <div class="stat-footer">အတည်မပြုရသေးသော အသုံးပြုသူများ</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">ငွေလွှဲအကြိမ်အရေအတွက်</div>
                    <div class="stat-icon icon-transactions"><i class="fas fa-exchange-alt"></i></div>
                </div>
                <div class="stat-value" id="total-transactions">0</div>
                <div class="stat-footer">စုစုပေါင်းငွေလွှဲမှုများ</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">စုစုပေါင်းငွေပမာဏ</div>
                    <div class="stat-icon icon-balance"><i class="fas fa-wallet"></i></div>
                </div>
                <div class="stat-value" id="total-balance">0 Ks</div>
                <div class="stat-footer">စနစ်အတွင်းရှိ ငွေပမာဏ</div>
            </div>
        </div>
        
        <!-- Control Panel -->
        <div class="card">
            <h2><i class="fas fa-sliders-h"></i> ထိန်းချုပ်မှုစနစ်</h2>
            <div class="button-grid">
                <button class="control-btn enable-btn" onclick="enableTransfers()">
                    <i class="fas fa-check-circle"></i>
                    ငွေလွှဲခြင်းဝန်ဆောင်မှု ဖွင့်မည်
                </button>
                <button class="control-btn disable-btn" onclick="disableTransfers()">
                    <i class="fas fa-ban"></i>
                    ငွေလွှဲခြင်းဝန်ဆောင်မှု ပိတ်မည်
                </button>
                <button class="control-btn system-btn" onclick="openMaintenanceModal()">
                    <i class="fas fa-tools"></i>
                    ပြုပြင်ထိန်းသိမ်းမှုမုဒ်
                </button>
                <button class="control-btn system-btn" onClick="openSystemSettingsModal()">
                    <i class="fas fa-cog"></i>
                    စနစ်ဆက်တင်များ
                </button>
            </div>
        </div>
        
        <!-- Bulk Deposit -->
        <div class="card">
            <h2><i class="fas fa-money-bill-wave"></i> ငွေဖြည့်ခြင်း</h2>
            
            <div id="bulk-deposit-message" class="hidden"></div>
            
            <div class="deposit-form">
                <div class="form-field">
                    <label for="deposit-type">ငွေဖြည့်ပုံစံ</label>
                    <select id="deposit-type" onchange="toggleDepositFields()">
                        <option value="single">တစ်ဦးချင်းစီ</option>
                        <option value="bulk">အတည်ပြုပြီးသူအားလုံး</option>
                    </select>
                </div>
                
                <div class="form-field" id="user-id-field">
                    <label for="user-id">အသုံးပြုသူ ID</label>
                    <input type="text" id="user-id" placeholder="အသုံးပြုသူ ID ထည့်ပါ">
                </div>
                
                <div class="form-field">
                    <label for="deposit-amount">ငွေပမာဏ (ကျပ်)</label>
                    <input type="number" id="deposit-amount" placeholder="ဖြည့်မည့်ပမာဏထည့်ပါ" required>
                </div>
                
                <div class="form-field">
                    <label for="deposit-note">မှတ်ချက်</label>
                    <input type="text" id="deposit-note" placeholder="မှတ်ချက် (မဖြစ်မနေမဟုတ်)">
                </div>
                
                <button onclick="processDeposit()" id="deposit-btn">
                    <i class="fas fa-paper-plane" style="margin-right: 8px;"></i>
                    ငွေဖြည့်မည်
                </button>
            </div>
        </div>
        
        <!-- User Search and List -->
        <div class="card">
            <h2><i class="fas fa-users"></i> အသုံးပြုသူများ</h2>
            
            <div class="search-form">
                <input type="text" id="search-input" placeholder="အသုံးပြုသူ ID သို့မဟုတ် ဖုန်းနံပါတ်ထည့်ပါ" oninput="searchUser()">
                <button onclick="searchUser()">
                    <i class="fas fa-search" style="margin-right: 5px;"></i>
                    ရှာမည်
                </button>
            </div>
            
            <div class="user-list">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ဖုန်းနံပါတ်</th>
                            <th>လက်ကျန်ငွေ</th>
                            <th>အခြေအနေ</th>
                            <th>သက်သေခံကတ်</th>
                            <th>ဓာတ်ပုံ</th>
                            <th>လုပ်ဆောင်ချက်များ</th>
                        </tr>
                    </thead>
                    <tbody id="user-table"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Image Preview Container -->
    <div class="img-preview-container" id="img-preview-container">
        <img src="" alt="Preview" class="img-preview" id="img-preview">
        <button class="img-preview-close" onclick="closeImagePreview()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Deposit Modal -->
    <div class="modal-overlay" id="deposit-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ငွေဖြည့်ရန် အတည်ပြုပါ</h3>
                <button class="modal-close" onclick="closeModal('deposit-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <p style="margin-bottom: 15px;">အောက်ပါ အသုံးပြုသူအား ငွေဖြည့်မှာ သေချာပါသလား?</p>
                
                <div class="form-field">
                    <label>အသုံးပြုသူ:</label>
                    <div style="font-weight: 600; color: var(--light);" id="confirm-user-id"></div>
                </div>
                
                <div class="form-field">
                    <label>ဖုန်းနံပါတ်:</label>
                    <div style="font-weight: 600; color: var(--light);" id="confirm-user-phone"></div>
                </div>
                
                <div class="form-field">
                    <label>ငွေပမာဏ:</label>
                    <div style="font-weight: 600; color: var(--primary); font-size: 1.2rem;" id="confirm-amount"></div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeModal('deposit-modal')">မလုပ်တော့ပါ</button>
                <button class="modal-btn" onclick="confirmDeposit()" id="confirm-deposit-btn">အတည်ပြုသည်</button>
            </div>
        </div>
    </div>
    
    <!-- Maintenance Mode Modal -->
    <div class="modal-overlay" id="maintenance-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ပြုပြင်ထိန်းသိမ်းမှုမုဒ်</h3>
                <button class="modal-close" onclick="closeModal('maintenance-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <p style="margin-bottom: 15px; color: var(--warning);">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                    သတိပြုရန်: ပြုပြင်ထိန်းသိမ်းမှုမုဒ်ကို ဖွင့်လိုက်ပါက အသုံးပြုသူများအနေဖြင့် ဝန်ဆောင်မှုကို အသုံးပြု၍ မရတော့ပါ။
                </p>
                
                <div class="form-field">
                    <label for="maintenance-message">ပြသမည့်မက်ဆေ့ချ်</label>
                    <input type="text" id="maintenance-message" placeholder="ဝန်ဆောင်မှုအား ပြုပြင်ထိန်းသိမ်းနေပါသည်">
                </div>
                
                <div class="form-field">
                    <label for="maintenance-duration">ကြာမြင့်မည့်အချိန် (မိနစ်)</label>
                    <input type="number" id="maintenance-duration" placeholder="30" value="30">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeModal('maintenance-modal')">မလုပ်တော့ပါ</button>
                <button class="modal-btn" onclick="setMaintenanceMode(true)" id="start-maintenance-btn">စတင်မည်</button>
            </div>
        </div>
    </div>
    
    <!-- System Settings Modal -->
    <div class="modal-overlay" id="system-settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">စနစ်ဆက်တင်များ</h3>
                <button class="modal-close" onclick="closeModal('system-settings-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="form-field">
                    <label for="min-transfer">အနည်းဆုံးလွှဲငွေပမာဏ (ကျပ်)</label>
                    <input type="number" id="min-transfer" placeholder="1000">
                </div>
                
                <div class="form-field">
                    <label for="max-transfer">အများဆုံးလွှဲငွေပမာဏ (ကျပ်)</label>
                    <input type="number" id="max-transfer" placeholder="1000000">
                </div>
                
                <div class="form-field">
                    <label for="transfer-fee">ငွေလွှဲကြေး (%)</label>
                    <input type="number" id="transfer-fee" placeholder="0" step="0.1" min="0" max="10">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="closeModal('system-settings-modal')">မလုပ်တော့ပါ</button>
                <button class="modal-btn" onclick="saveSystemSettings()" id="save-settings-btn">သိမ်းဆည်းမည်</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase Client
        const supabaseUrl = 'https://vtsczzlnhsrgnbkfyizi.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0c2N6emxuaHNyZ25ia2Z5aXppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI2ODYwODMsImV4cCI6MjA1ODI2MjA4M30.LjP2g0WXgg6FVTM5gPIkf_qlXakkj8Hf5xzXVsx7y68';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey, { fetch: (...args) => fetch(...args) });
        
        // Admin credentials (normally should be stored more securely)
        const ADMIN_EMAIL = 'admin@kpayplus.com';
        const ADMIN_PIN = '123456';
        
        // Global variables
        let selectedUserId = null;
        let selectedUserPhone = null;
        let systemSettings = {
            allowTransfers: true,
            maintenanceMode: false,
            minTransferAmount: 1000,
            maxTransferAmount: 1000000,
            transferFeePercent: 0
        };
        
        // Create background particles
        function createParticles() {
            const container = document.getElementById('particles-container');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size between 5px and 20px
                const size = Math.random() * 15 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random position
                const posX = Math.random() * 100;
                particle.style.left = `${posX}%`;
                particle.style.bottom = `-${size}px`;
                
                // Random speed between 30s and 60s
                const duration = Math.random() * 30 + 30;
                particle.style.animationDuration = `${duration}s`;
                
                // Add to container
                container.appendChild(particle);
            }
        }
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('my-MM').format(amount);
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('my-MM', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Show message
        function showMessage(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            container.className = `message message-${type}`;
            
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'info':
                    icon = '<i class="fas fa-info-circle"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    break;
            }
            
            container.innerHTML = `${icon} ${message}`;
            container.classList.remove('hidden');
            
            setTimeout(() => {
                container.classList.add('hidden');
            }, 5000);
        }
        
        // Retry operation with backoff
        async function retryOperation(operation, maxRetries = 3, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await operation();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    console.warn(`Retry ${i + 1}/${maxRetries} failed: ${error.message}`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        // Admin login
        function adminLogin() {
            const email = document.getElementById('admin-email').value;
            const pin = document.getElementById('admin-pin').value;
            const errorMessage = document.getElementById('login-error');
            
            if (!email || !pin) {
                errorMessage.textContent = 'အီးမေးလ်နှင့် PIN ထည့်သွင်းပေးပါ';
                errorMessage.classList.remove('hidden');
                return;
            }
            
            if (email === ADMIN_EMAIL && pin === ADMIN_PIN) {
                document.getElementById('login-container').classList.add('hidden');
                document.getElementById('dashboard-container').classList.remove('hidden');
                
                loadDashboard();
                loadUsers();
                getSystemSettings();
            } else {
                errorMessage.textContent = 'အီးမေးလ် သို့မဟုတ် PIN မှားယွင်းနေပါသည်';
                errorMessage.classList.remove('hidden');
            }
        }
        
        // Load dashboard stats
        async function loadDashboard() {
            try {
                // Get total users
                const { count: totalUsers, error: userError } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true });
                
                if (userError) throw new Error(`Fetch Users Error: ${userError.message}`);
                document.getElementById('total-users').textContent = totalUsers;
                
                // Get pending users
                const { count: pendingUsers, error: pendingError } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .eq('passport_status', 'pending');
                
                if (pendingError) throw new Error(`Fetch Pending Users Error: ${pendingError.message}`);
                document.getElementById('pending-users').textContent = pendingUsers;
                
                // Get total transactions
                const { count: totalTransactions, error: transactionError } = await supabase
                    .from('transactions')
                    .select('*', { count: 'exact', head: true });
                
                if (transactionError) throw new Error(`Fetch Transactions Error: ${transactionError.message}`);
                document.getElementById('total-transactions').textContent = totalTransactions;
                
                // Get total balance
                const { data: balanceData, error: balanceError } = await supabase
                    .from('users')
                    .select('balance');
                
                if (balanceError) throw new Error(`Fetch Balance Error: ${balanceError.message}`);
                
                const totalBalance = balanceData.reduce((sum, user) => sum + user.balance, 0);
                document.getElementById('total-balance').textContent = `${formatCurrency(totalBalance)} Ks`;
                
            } catch (error) {
                console.error('Load Dashboard Error:', error.message);
                alert(`စနစ်အချက်အလက်များ ရယူရာတွင် အမှားရှိပါသည်: ${error.message}`);
            }
        }
        
        // Get system settings
        async function getSystemSettings() {
            try {
                const { data, error } = await supabase
                    .from('settings')
                    .select('*')
                    .single();
                
                if (error) throw new Error(`Fetch Settings Error: ${error.message}`);
                
                systemSettings = {
                    allowTransfers: data.allow_transfers,
                    maintenanceMode: data.maintenance_mode,
                    minTransferAmount: data.min_transfer_amount,
                    maxTransferAmount: data.max_transfer_amount,
                    transferFeePercent: data.transfer_fee_percent
                };
                
                // Update settings form
                document.getElementById('min-transfer').value = systemSettings.minTransferAmount;
                document.getElementById('max-transfer').value = systemSettings.maxTransferAmount;
                document.getElementById('transfer-fee').value = systemSettings.transferFeePercent;
                
            } catch (error) {
                console.error('Get Settings Error:', error.message);
            }
        }
        
        // Load users
        async function loadUsers(searchQuery = '') {
            try {
                document.getElementById('user-table').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center;">
                            <div class="loading"></div> အသုံးပြုသူများကို ရယူနေပါသည်...
                        </td>
                    </tr>
                `;
                
                let query = supabase.from('users').select('*');
                if (searchQuery) {
                    query = query.or(`user_id.ilike.%${searchQuery}%,phone.ilike.%${searchQuery}%`);
                }
                
                const { data: users, error } = await query;
                if (error) throw new Error(`Fetch Users Error: ${error.message}`);
                
                const userTable = document.getElementById('user-table');
                userTable.innerHTML = '';
                
                if (users.length === 0) {
                    userTable.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px;">
                                <i class="fas fa-user-slash" style="font-size: 2rem; margin-bottom: 10px; color: var(--gray);"></i>
                                <p>အသုံးပြုသူများ မရှိသေးပါ</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                users.forEach(user => {
                    const row = document.createElement('tr');
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    switch(user.passport_status) {
                        case 'pending':
                            statusClass = 'status-pending';
                            statusText = 'စစ်ဆေးဆဲ';
                            break;
                        case 'approved':
                            statusClass = 'status-approved';
                            statusText = 'အတည်ပြုပြီး';
                            break;
                        case 'rejected':
                            statusClass = 'status-rejected';
                            statusText = 'ငြင်းပယ်ထားသည်';
                            break;
                    }
                    
                    row.innerHTML = `
                        <td>${user.user_id}</td>
                        <td>${user.phone || 'N/A'}</td>
                        <td>${formatCurrency(user.balance)} Ks</td>
                        <td><span class="user-status ${statusClass}">${statusText}</span></td>
                        <td>
                            ${user.passport_image 
                                ? `<img src="${user.passport_image}" alt="Passport" onclick="previewImage('${user.passport_image}')">`
                                : '<span style="color: var(--gray);">မရှိသေးပါ</span>'}
                        </td>
                        <td>
                            ${user.selfie_image 
                                ? `<img src="${user.selfie_image}" alt="Selfie" onclick="previewImage('${user.selfie_image}')">`
                                : '<span style="color: var(--gray);">မရှိသေးပါ</span>'}
                        </td>
                        <td>
                            <div class="action-buttons">
                                ${user.passport_status === 'pending' ? `
                                    <button class="action-btn approve-btn" onclick="updateStatus('${user.user_id}', 'approved')">
                                        <i class="fas fa-check"></i> အတည်ပြုမည်
                                    </button>
                                    <button class="action-btn reject-btn" onclick="updateStatus('${user.user_id}', 'rejected')">
                                        <i class="fas fa-times"></i> ငြင်းပယ်မည်
                                    </button>
                                ` : ''}
                                <button class="action-btn deposit-btn" onclick="showDepositModal('${user.user_id}', '${user.phone || 'N/A'}')">
                                    <i class="fas fa-money-bill-wave"></i> ငွေဖြည့်မည်
                                </button>
                            </div>
                        </td>
                    `;
                    
                    userTable.appendChild(row);
                });
                
            } catch (error) {
                console.error('Load Users Error:', error.message);
                document.getElementById('user-table').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px; color: var(--error);">
                            <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>အသုံးပြုသူများ ရယူရာတွင် အမှားရှိပါသည်</p>
                        </td>
                    </tr>
                `;
            }
        }
        
        // Search user
        function searchUser() {
            const searchQuery = document.getElementById('search-input').value;
            loadUsers(searchQuery);
        }
        
        // Update user status
        async function updateStatus(userId, status) {
            try {
                const confirmMessage = status === 'approved' 
                    ? `${userId} ကို အတည်ပြုမှာ သေချာပါသလား?`
                    : `${userId} ကို ငြင်းပယ်မှာ သေချာပါသလား?`;
                
                if (!confirm(confirmMessage)) return;
                
                await retryOperation(async () => {
                    const { error } = await supabase
                        .from('users')
                        .update({ passport_status: status })
                        .eq('user_id', userId);
                    
                    if (error) throw new Error(`Update Status Error: ${error.message}`);
                });
                
                alert(`အသုံးပြုသူကို ${status === 'approved' ? 'အတည်ပြု' : 'ငြင်းပယ်'}ပြီးပါပြီ`);
                loadUsers();
                loadDashboard();
                
            } catch (error) {
                console.error('Update Status Error:', error.message);
                alert(`အသုံးပြုသူအခြေအနေ ပြောင်းလဲရာတွင် အမှားရှိပါသည်: ${error.message}`);
            }
        }
        
        // Show deposit modal
        function showDepositModal(userId, phone) {
            selectedUserId = userId;
            selectedUserPhone = phone;
            
            document.getElementById('confirm-user-id').textContent = userId;
            document.getElementById('confirm-user-phone').textContent = phone;
            
            const amount = document.getElementById('deposit-amount').value;
            if (!amount || isNaN(amount) || amount <= 0) {
                alert('ကျေးဇူးပြု၍ မှန်ကန်သော ငွေပမာဏထည့်ပါ');
                return;
            }
            
            document.getElementById('confirm-amount').textContent = `${formatCurrency(amount)} ကျပ်`;
            document.getElementById('deposit-modal').style.display = 'flex';
        }
        
        // Toggle deposit fields
        function toggleDepositFields() {
            const depositType = document.getElementById('deposit-type').value;
            const userIdField = document.getElementById('user-id-field');
            
            if (depositType === 'bulk') {
                userIdField.classList.add('hidden');
            } else {
                userIdField.classList.remove('hidden');
            }
        }
        
        // Process deposit
        function processDeposit() {
            const depositType = document.getElementById('deposit-type').value;
            const amount = document.getElementById('deposit-amount').value;
            
            if (!amount || isNaN(amount) || amount <= 0) {
                alert('ကျေးဇူးပြု၍ မှန်ကန်သော ငွေပမာဏထည့်ပါ');
                return;
            }
            
            if (depositType === 'single') {
                const userId = document.getElementById('user-id').value;
                if (!userId) {
                    alert('ကျေးဇူးပြု၍ အသုံးပြုသူ ID ထည့်ပါ');
                    return;
                }
                
                // Find the user first
                getUserByIdAsync(userId)
                    .then(user => {
                        if (user) {
                            showDepositModal(userId, user.phone || 'N/A');
                        } else {
                            alert('အသုံးပြုသူရှာမတွေ့ပါ');
                        }
                    })
                    .catch(error => {
                        alert(`အသုံးပြုသူရှာဖွေရာတွင် အမှားရှိပါသည်: ${error.message}`);
                    });
            } else {
                if (confirm(`အတည်ပြုပြီးသူအားလုံးထံသို့ ${formatCurrency(amount)} ကျပ်စီ ဖြည့်မှာ သေချာပါသလား?`)) {
                    processBulkDeposit(amount);
                }
            }
        }
        
        // Get user by ID
        async function getUserByIdAsync(userId) {
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('user_id', userId)
                    .single();
                
                if (error && error.code !== 'PGRST116') throw error;
                return data;
            } catch (error) {
                console.error('Get User Error:', error.message);
                throw error;
            }
        }
        
        // Confirm deposit
        async function confirmDeposit() {
            try {
                // Show loading state
                const confirmBtn = document.getElementById('confirm-deposit-btn');
                const originalText = confirmBtn.textContent;
                confirmBtn.innerHTML = '<div class="loading"></div> စောင့်ဆိုင်းပေးပါ...';
                confirmBtn.disabled = true;
                
                const amount = parseInt(document.getElementById('deposit-amount').value);
                const note = document.getElementById('deposit-note').value || 'Admin မှငွေဖြည့်ပေးခြင်း';
                
                // Get current balance
                const { data: user, error: fetchError } = await supabase
                    .from('users')
                    .select('balance')
                    .eq('user_id', selectedUserId)
                    .single();
                
                if (fetchError) throw new Error(`Fetch User Error: ${fetchError.message}`);
                
                const newBalance = user.balance + parseInt(amount);
                
                // Update balance
                const { error: updateError } = await supabase
                    .from('users')
                    .update({ balance: newBalance })
                    .eq('user_id', selectedUserId);
                
                if (updateError) throw new Error(`Update Balance Error: ${updateError.message}`);
                
                // Create transaction record
                const transactionId = 'ADMIN' + Date.now() + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                
                const { error: transactionError } = await supabase
                    .from('transactions')
                    .insert({
                        transaction_id: transactionId,
                        from_user_id: 'ADMIN',
                        to_user_id: selectedUserId,
                        from_phone: 'ADMIN',
                        to_phone: selectedUserPhone,
                        amount: amount,
                        fee: 0,
                        note: note,
                        created_at: new Date().toISOString()
                    });
                
                if (transactionError) throw new Error(`Transaction Error: ${transactionError.message}`);
                
                // Close modal and show success
                closeModal('deposit-modal');
                showMessage('bulk-deposit-message', `${selectedUserId} သို့ ${formatCurrency(amount)} ကျပ် ဖြည့်ပြီးပါပြီ`, 'success');
                
                // Reset form
                document.getElementById('user-id').value = '';
                document.getElementById('deposit-amount').value = '';
                document.getElementById('deposit-note').value = '';
                
                // Refresh users list and dashboard
                loadUsers();
                loadDashboard();
                
            } catch (error) {
                console.error('Deposit Error:', error.message);
                alert(`ငွေဖြည့်ရာတွင် အမှားရှိပါသည်: ${error.message}`);
            } finally {
                // Reset button
                const confirmBtn = document.getElementById('confirm-deposit-btn');
                confirmBtn.textContent = 'အတည်ပြုသည်';
                confirmBtn.disabled = false;
                
                // Close modal
                closeModal('deposit-modal');
            }
        }
        
        // Process bulk deposit
        async function processBulkDeposit(amount) {
            try {
                // Show loading message
                showMessage('bulk-deposit-message', '<div class="loading"></div> ငွေဖြည့်ခြင်းလုပ်ငန်းစဥ် ဆောင်ရွက်နေပါသည်...', 'info');
                
                // Disable deposit button
                const depositBtn = document.getElementById('deposit-btn');
                depositBtn.disabled = true;
                
                const { data: users, error: fetchError } = await supabase
                    .from('users')
                    .select('user_id, balance, phone')
                    .eq('passport_status', 'approved');
                
                if (fetchError) throw new Error(`Fetch Users Error: ${fetchError.message}`);
                
                if (users.length === 0) {
                    showMessage('bulk-deposit-message', 'အတည်ပြုပြီးသော အသုံးပြုသူများ မရှိသေးပါ', 'warning');
                    return;
                }
                
                // Process each user
                let successCount = 0;
                let errorCount = 0;
                
                for (const user of users) {
                    try {
                        // Update balance
                        const newBalance = user.balance + parseInt(amount);
                        const { error: updateError } = await supabase
                            .from('users')
                            .update({ balance: newBalance })
                            .eq('user_id', user.user_id);
                        
                        if (updateError) throw new Error(`Update Balance Error: ${updateError.message}`);
                        
                        // Create transaction record
                        const transactionId = 'BULK' + Date.now() + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                        
                        const { error: transactionError } = await supabase
                            .from('transactions')
                            .insert({
                                transaction_id: transactionId,
                                from_user_id: 'ADMIN',
                                to_user_id: user.user_id,
                                from_phone: 'ADMIN',
                                to_phone: user.phone || 'N/A',
                                amount: parseInt(amount),
                                fee: 0,
                                note: 'Admin မှအုပ်စုလိုက်ငွေဖြည့်ပေးခြင်း',
                                created_at: new Date().toISOString()
                            });
                        
                        if (transactionError) throw new Error(`Transaction Error: ${transactionError.message}`);
                        
                        successCount++;
                    } catch (error) {
                        console.error(`Error processing user ${user.user_id}:`, error.message);
                        errorCount++;
                    }
                }
                
                // Show results
                showMessage('bulk-deposit-message', `အတည်ပြုပြီးသော အသုံးပြုသူ ${successCount} ယောက်ထံသို့ ${formatCurrency(amount)} ကျပ်စီ ဖြည့်ပြီးပါပြီ ${errorCount > 0 ? `(${errorCount} ယောက်တွင် အမှားရှိပါသည်)` : ''}`, 'success');
                
                // Reset form
                document.getElementById('deposit-amount').value = '';
                document.getElementById('deposit-note').value = '';
                
                // Refresh users list and dashboard
                loadUsers();
                loadDashboard();
                
            } catch (error) {
                console.error('Bulk Deposit Error:', error.message);
                showMessage('bulk-deposit-message', `အုပ်စုလိုက်ငွေဖြည့်ရာတွင် အမှားရှိပါသည်: ${error.message}`, 'error');
            } finally {
                // Enable deposit button
                document.getElementById('deposit-btn').disabled = false;
            }
        }
        
        // Enable transfers
        async function enableTransfers() {
            try {
                await retryOperation(async () => {
                    const { error } = await supabase
                        .from('settings')
                        .update({ allow_transfers: true })
                        .eq('id', 1);
                    
                    if (error) throw new Error(`Enable Transfers Error: ${error.message}`);
                });
                
                systemSettings.allowTransfers = true;
                alert('ငွေလွှဲခြင်းဝန်ဆောင်မှု အောင်မြင်စွာဖွင့်ပြီးပါပြီ');
            } catch (error) {
                console.error('Enable Transfers Error:', error.message);
                alert(`ငွေလွှဲခြင်းဝန်ဆောင်မှု ဖွင့်ရာတွင် အမှားရှိပါသည်: ${error.message}`);
            }
        }
        
        // Disable transfers
        async function disableTransfers() {
            try {
                await retryOperation(async () => {
                    const { error } = await supabase
                        .from('settings')
                        .update({ allow_transfers: false })
                        .eq('id', 1);
                    
                    if (error) throw new Error(`Disable Transfers Error: ${error.message}`);
                });
                
                systemSettings.allowTransfers = false;
                alert('ငွေလွှဲခြင်းဝန်ဆောင်မှု အောင်မြင်စွာပိတ်ပြီးပါပြီ');
            } catch (error) {
                console.error('Disable Transfers Error:', error.message);
                alert(`ငွေလွှဲခြင်းဝန်ဆောင်မှု ပိတ်ရာတွင် အမှားရှိပါသည်: ${error.message}`);
            }
        }
        
        // Open maintenance mode modal
        function openMaintenanceModal() {
            document.getElementById('maintenance-modal').style.display = 'flex';
        }
        
        // Open system settings modal
        function openSystemSettingsModal() {
            document.getElementById('system-settings-modal').style.display = 'flex';
        }
        
        // Set maintenance mode
        async function setMaintenanceMode(enabled) {
            try {
                const message = document.getElementById('maintenance-message').value || 'ဝန်ဆောင်မှုအား ပြုပြင်ထိန်းသိမ်းနေပါသည်';
                const duration = parseInt(document.getElementById('maintenance-duration').value) || 30;
                
                await retryOperation(async () => {
                    const { error } = await supabase
                        .from('settings')
                        .update({ 
                            maintenance_mode: enabled,
                            maintenance_message: message,
                            maintenance_end_time: new Date(Date.now() + duration * 60000).toISOString()
                        })
                        .eq('id', 1);
                    
                    if (error) throw new Error(`Maintenance Mode Error: ${error.message}`);
                });
                
                systemSettings.maintenanceMode = enabled;
                closeModal('maintenance-modal');
                
                if (enabled) {
                    alert(`ပြုပြင်ထိန်းသိမ်းမှုမုဒ် စတင်ပြီးပါပြီ (${duration} မိနစ်ကြာမည်)`);
                    
                    // Auto-disable after duration
                    setTimeout(async () => {
                        try {
                            await retryOperation(async () => {
                                const { error } = await supabase
                                    .from('settings')
                                    .update({ maintenance_mode: false })
                                    .eq('id', 1);
                                
                                if (error) throw new Error(`Disable Maintenance Error: ${error.message}`);
                            });
                            
                            alert('ပြုပြင်ထိန်းသိမ်းမှုမုဒ် အလိုအလျောက်ပိတ်ပြီးပါပြီ');
                        } catch (error) {
                            console.error('Auto-disable Maintenance Error:', error.message);
                        }
                    }, duration * 60000);
                } else {
                    alert('ပြုပြင်ထိန်းသိမ်းမှုမုဒ် ပိတ်ပြီးပါပြီ');
                }
            } catch (error) {
                console.error('Maintenance Mode Error:', error.message);
                alert(`ပြုပြင်ထိန်းသိမ်းမှုမုဒ် ပြောင်းလဲရာတွင် အမှားရှိပါသည်: ${error.message}`);
            }
        }
        
        // Save system settings
        async function saveSystemSettings() {
            try {
                const minTransfer = parseInt(document.getElementById('min-transfer').value) || 1000;
                const maxTransfer = parseInt(document.getElementById('max-transfer').value) || 1000000;
                const transferFee = parseFloat(document.getElementById('transfer-fee').value) || 0;
                
                if (minTransfer <= 0 || maxTransfer <= 0 || transferFee < 0) {
                    alert('ကျေးဇူးပြု၍ မှန်ကန်သော တန်ဖိုးများထည့်ပါ');
                    return;
                }
                
                if (minTransfer >= maxTransfer) {
                    alert('အနည်းဆုံးလွှဲငွေပမာဏသည် အများဆုံးလွှဲငွေပမာဏထက် နည်းရပါမည်');
                    return;
                }
                
                await retryOperation(async () => {
                    const { error } = await supabase
                        .from('settings')
                        .update({
                            min_transfer_amount: minTransfer,
                            max_transfer_amount: maxTransfer,
                            transfer_fee_percent: transferFee
                        })
                        .eq('id', 1);
                    
                    if (error) throw new Error(`Update Settings Error: ${error.message}`);
                });
                
                systemSettings.minTransferAmount = minTransfer;
                systemSettings.maxTransferAmount = maxTransfer;
                systemSettings.transferFeePercent = transferFee;
                
                closeModal('system-settings-modal');
                alert('စနစ်ဆက်တင်များ အောင်မြင်စွာသိမ်းဆည်းပြီးပါပြီ');
            } catch (error) {
                console.error('Save Settings Error:', error.message);
                alert(`စနစ်ဆက်တင်များ သိမ်းဆည်းရာတွင် အမှားရှိပါသည်: ${error.message}`);
            }
        }
        
        // Preview image
        function previewImage(url) {
            document.getElementById('img-preview').src = url;
            document.getElementById('img-preview-container').style.display = 'flex';
        }
        
        // Close image preview
        function closeImagePreview() {
            document.getElementById('img-preview-container').style.display = 'none';
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Initialize
        window.onload = () => {
            createParticles();
            
            // Add event listeners for Enter key in login
            document.getElementById('admin-email').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('admin-pin').focus();
                }
            });
            
            document.getElementById('admin-pin').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    adminLogin();
                }
            });
            
            // Close image preview on ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeImagePreview();
                    closeModal('deposit-modal');
                    closeModal('maintenance-modal');
                    closeModal('system-settings-modal');
                }
            });
        };
    </script>
</body>
</html>

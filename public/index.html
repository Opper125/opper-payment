<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KPAY+ Premium Payment</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Intro Animation -->
    <div class="intro-container" id="intro-container">
        <div class="intro-logo-wrapper">
            <div class="intro-logo-circle"></div>
            <img class="intro-logo" src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="OPPER+ Logo">
        </div>
        <div class="intro-text">
            <span class="primary">KPAY+</span> Premium
        </div>
        <div class="intro-tagline">ဘယ်နေရာမှာမဆို ငွေပေးချေနိုင်သော စနစ်</div>
    </div>

    <!-- Download APK Bar -->
    <div class="download-bar" id="download-bar">
        <p>KPAY+ App ကိုရယူပြီး အကောင်းဆုံးအတွေ့အကြုံကို ခံစားလိုက်ပါ။</p>
        <div style="display: flex; align-items: center; gap: 10px;">
            <button onclick="downloadApk()">ဒေါင်းလုပ်ဆွဲမည်</button>
            <button class="close-btn" onclick="hideDownloadBar()"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <!-- Background Particles -->
    <div class="particles-container" id="particles-container"></div>

    <!-- Logo and ID Badge -->
    <div class="logo-header">
        <img class="logo" src="https://github.com/Opper125/opper-payment/raw/main/logo.png" alt="OPPER+ Logo">
        <div class="id-badge" id="id-badge">ID: ဖော်ပြထားခြင်းမရှိသေးပါ</div>
    </div>

    <!-- Login/Register Container -->
    <div id="login-container" class="container active">
        <h2>KPAY+ Premium အကောင့်</h2>
        
        <!-- Login Form -->
        <div id="login-form" class="form-group">
            <h3 style="text-align: center; margin-bottom: 20px;">အကောင့်ဝင်ရန်</h3>
            
            <label>အီးမေးလ်</label>
            <div class="icon-input">
                <i class="fas fa-envelope icon"></i>
                <input type="email" id="login-email" placeholder="သင့်အီးမေးလ်ထည့်ပါ" required>
            </div>
            
            <label class="mt-15">စကားဝှက်</label>
            <div class="icon-input">
                <i class="fas fa-lock icon"></i>
                <input type="password" id="login-password" placeholder="စကားဝှက်ထည့်ပါ" required>
            </div>
            
            <div class="mt-20">
                <button id="login-btn">အကောင့်ဝင်မည်</button>
            </div>
        </div>
        
        <!-- Register Form -->
        <div id="register-form" class="form-group hidden">
            <h3 style="text-align: center; margin-bottom: 20px;">အကောင့်သစ်ဖွင့်ရန်</h3>
            
            <label>အီးမေးလ်</label>
            <div class="icon-input">
                <i class="fas fa-envelope icon"></i>
                <input type="email" id="register-email" placeholder="သင့်အီးမေးလ်ထည့်ပါ" required>
            </div>
            
            <label class="mt-15">ဖုန်းနံပါတ် (09xxxxxxxxx)</label>
            <div class="icon-input">
                <i class="fas fa-phone icon"></i>
                <input type="tel" id="register-phone" placeholder="09xxxxxxxxx" required>
            </div>
            
            <label class="mt-15">စကားဝှက်</label>
            <div class="icon-input">
                <i class="fas fa-lock icon"></i>
                <input type="password" id="register-password" placeholder="စကားဝှက်ထည့်ပါ" required>
            </div>
            
            <label class="mt-15">စကားဝှက် အတည်ပြုရန်</label>
            <div class="icon-input">
                <i class="fas fa-lock icon"></i>
                <input type="password" id="register-confirm-password" placeholder="စကားဝှက်ကို ထပ်မံ ထည့်သွင်းပါ" required>
            </div>
            
            <div class="mt-20">
                <button id="register-btn">အကောင့်ဖွင့်မည်</button>
            </div>
        </div>
        
        <div class="mt-15" style="text-align: center;">
            <button id="auth-toggle-btn" style="background: transparent; color: var(--primary); box-shadow: none; text-decoration: underline; width: auto; padding: 5px;">အကောင့်သစ်ဖွင့်ရန်</button>
        </div>
    </div>

    <!-- Wallet Section -->
    <div id="wallet" class="container">
        <h2>ငွေအိတ်</h2>
        
        <div class="balance-card">
            <div class="balance-display">
                <div class="balance-card-pattern"></div>
                <div class="balance-label">လက်ကျန်ငွေ</div>
                <div class="balance-amount">
                    <span class="currency">Ks</span>
                    <span id="balance">0</span>
                </div>
                <div class="balance-actions">
                    <button class="balance-action-btn" onclick="showTopupOptions()">ငွေဖြည့်မည်</button>
                    <button class="balance-action-btn" id="transfer-btn" onclick="toggleTransfer()">ငွေလွှဲမည်</button>
                </div>
            </div>
            <div id="wallet-status-container" class="mt-5" style="text-align: center;">
                <span id="wallet-status" class="status pending">အကောင့်အတည်ပြုရန်လိုအပ်နေသည်</span>
            </div>
        </div>
        
        <div id="transfer" class="form-group hidden">
            <h3 style="text-align: center; margin-bottom: 20px;">ငွေလွှဲခြင်း</h3>
            
            <label>လက်ခံမည့်ဖုန်းနံပါတ်</label>
            <div class="icon-input">
                <i class="fas fa-phone icon"></i>
                <input type="tel" id="transfer-phone" placeholder="09xxxxxxxxx" required oninput="checkPhone()">
            </div>
            <p id="receiver-name" class="mt-5" style="font-weight: 600;"></p>
            
            <label class="mt-15">ငွေပမာဏ (ကျပ်)</label>
            <div class="icon-input">
                <i class="fas fa-money-bill-wave icon"></i>
                <input type="number" id="transfer-amount" placeholder="1,000,000 ကျပ်အထိ" required>
            </div>
            
            <label class="mt-15">မှတ်ချက်</label>
            <div class="icon-input">
                <i class="fas fa-sticky-note icon"></i>
                <input type="text" id="transfer-note" placeholder="မှတ်ချက် (ထည့်လိုက မထည့်လိုက ရပါသည်)">
            </div>
            
            <label class="mt-15">လုံခြုံရေးပင်နံပါတ် (၆ လုံး)</label>
            <div class="icon-input">
                <i class="fas fa-lock icon"></i>
                <input type="password" id="transfer-pin" maxlength="6" placeholder="၆ လုံးပင်နံပါတ်ထည့်ပါ" required>
            </div>
            
            <div class="mt-20">
                <button id="confirm-transfer-btn">ငွေလွှဲမည်</button>
            </div>
            <button class="mt-10" style="background: var(--gray-dark);" onclick="toggleTransfer()">နောက်သို့</button>
            <p id="transfer-error" class="error-message hidden"></p>
        </div>
    </div>

    <!-- Transaction History Section -->
    <div id="history" class="container">
        <h2>ငွေသွင်း/ထုတ် မှတ်တမ်း</h2>
        
        <div class="history-header">
            <select id="month-filter" onchange="loadHistory()">
                <option value="current">လက်ရှိလ</option>
                <option value="previous">ပြီးခဲ့သောလ</option>
                <option value="all">အားလုံး</option>
            </select>
            
            <div class="history-summary">
                <div class="summary-row">
                    <span class="summary-label">ရရှိခဲ့သော စုစုပေါင်း</span>
                    <span class="summary-value value-in" id="total-in">0 ကျပ်</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">ပို့ခဲ့သော စုစုပေါင်း</span>
                    <span class="summary-value value-out" id="total-out">0 ကျပ်</span>
                </div>
            </div>
        </div>
        
        <div id="history-list" style="overflow-y: auto;"></div>
    </div>

    <!-- Profile Section -->
    <div id="profile" class="container">
        <h2>ကိုယ်ရေးအချက်အလက်</h2>
        
        <div class="form-group">
            <p style="margin-bottom: 10px;">သင့်အိုင်ဒီ: <span id="profile-id" style="font-weight: 600;"></span></p>
            <p id="profile-status-container" style="margin-bottom: 20px; text-align: center;">
                <span id="profile-status" class="status pending">အကောင့်အတည်ပြုရန်လိုအပ်နေသည်</span>
            </p>
            
            <div id="passport-form" class="form-group">
                <h3 style="text-align: center; margin-bottom: 20px;">အကောင့်အတည်ပြုရန် အချက်အလက်များ</h3>
                
                <!-- Location Information -->
                <div class="address-section">
                    <div class="address-row">
                        <div class="location-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="address-content">
                            <div class="address-label">တည်နေရာ</div>
                            <div class="address-value" id="location-display">ရန်ကုန်တိုင်း ဒေါပုံမြို့နယ် Dawbon No 1</div>
                        </div>
                    </div>
                </div>
                
                <label>သက်သေခံကတ်ပြားအမှတ်</label>
                <div class="icon-input">
                    <i class="fas fa-id-card icon"></i>
                    <input type="text" id="passport-number" placeholder="သက်သေခံကတ်ပြားအမှတ်ထည့်ပါ" required>
                </div>
                
                <label class="mt-15">နေရပ်လိပ်စာ</label>
                <div class="icon-input">
                    <i class="fas fa-home icon"></i>
                    <input type="text" id="address" placeholder="နေရပ်လိပ်စာထည့်ပါ" required>
                </div>
                
                <label class="mt-15">ဖုန်းနံပါတ် (09xxxxxxxxx)</label>
                <div class="icon-input">
                    <i class="fas fa-phone icon"></i>
                    <input type="tel" id="phone" placeholder="09xxxxxxxxx" required>
                </div>
                
                <label class="mt-15">လုံခြုံရေးပင်နံပါတ် (၆ လုံး)</label>
                <div class="icon-input">
                    <i class="fas fa-lock icon"></i>
                    <input type="password" id="payment-pin" maxlength="6" placeholder="၆ လုံးပင်နံပါတ်ထည့်ပါ" required>
                </div>
                
                <label class="mt-15">သက်သေခံကတ်ပြား ဓာတ်ပုံ</label>
                <div class="file-upload-container">
                    <input type="file" id="passport-image" accept="image/*" onchange="previewFile('passport-image')">
                    <div class="file-upload-label">
                        <i class="fas fa-upload file-upload-icon"></i>
                        <span>ဓာတ်ပုံရွေးချယ်ရန် နှိပ်ပါ</span>
                    </div>
                    <div id="passport-image-name" class="file-name"></div>
                    <img id="passport-image-preview" class="file-preview">
                </div>
                
                <label class="mt-15">သက်သေခံကတ်ပြားနှင့်အတူ ကိုယ်တိုင်ဓာတ်ပုံ</label>
                <div class="file-upload-container">
                    <input type="file" id="selfie-image" accept="image/*" onchange="previewFile('selfie-image')">
                    <div class="file-upload-label">
                        <i class="fas fa-upload file-upload-icon"></i>
                        <span>ဓာတ်ပုံရွေးချယ်ရန် နှိပ်ပါ</span>
                    </div>
                    <div id="selfie-image-name" class="file-name"></div>
                    <img id="selfie-image-preview" class="file-preview">
                </div>
                
                <button id="submit-passport-btn" class="mt-20">တင်သွင်းမည်</button>
            </div>
            
            <div id="passport-submitted" class="hidden" style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: var(--radius-md); margin-top: 20px;">
                <h3 style="text-align: center; margin-bottom: 15px;">တင်သွင်းပြီးပါပြီ</h3>
                <p style="margin-bottom: 10px;">ဖုန်းနံပါတ်: <span id="submitted-phone" style="font-weight: 600;"></span></p>
                <p style="margin-bottom: 10px;">သက်သေခံကတ်ပြားအမှတ်: <span id="submitted-passport" style="font-weight: 600;"></span></p>
                <p style="margin-bottom: 10px;">နေရပ်လိပ်စာ: <span id="submitted-address" style="font-weight: 600;"></span></p>
                <p>တင်သွင်းသည့်အချိန်: <span id="submitted-time" style="font-weight: 600;"></span></p>
            </div>
            
            <div class="mt-20">
                <button id="logout-btn" style="background: var(--error);">
                    <i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i> အကောင့်မှထွက်ရန်
                </button>
            </div>
        </div>
    </div>

    <!-- Services Section -->
    <div id="services" class="container">
        <h2>ဝန်ဆောင်မှုများ</h2>
        
        <div class="services-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
            <button style="display: flex; flex-direction: column; align-items: center; height: 120px; justify-content: center;" onclick="showService('mobile-topup')">
                <i class="fas fa-mobile-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                ဖုန်းငွေဖြည့်ရန်
            </button>
            
            <button style="display: flex; flex-direction: column; align-items: center; height: 120px; justify-content: center;" onclick="showService('bill-payment')">
                <i class="fas fa-file-invoice" style="font-size: 2rem; margin-bottom: 10px;"></i>
                ဘေလ်ပေးချေရန်
            </button>
            
            <button style="display: flex; flex-direction: column; align-items: center; height: 120px; justify-content: center;" onclick="showService('game-topup')">
                <i class="fas fa-gamepad" style="font-size: 2rem; margin-bottom: 10px;"></i>
                ဂိမ်းငွေဖြည့်ရန်
            </button>
            
            <button style="display: flex; flex-direction: column; align-items: center; height: 120px; justify-content: center;" onclick="showService('merchant')">
                <i class="fas fa-store" style="font-size: 2rem; margin-bottom: 10px;"></i>
                ဆိုင်များ
            </button>
        </div>
        
        <div id="service-details" class="hidden" style="margin-top: 25px;">
            <h3 id="service-title" style="text-align: center; margin-bottom: 20px;"></h3>
            <div id="service-content"></div>
            <button style="background: var(--gray-dark); margin-top: 20px;" onclick="hideServiceDetails()">နောက်သို့</button>
        </div>
    </div>

    <!-- Receipt Overlay -->
    <div class="receipt-overlay" id="receipt-overlay">
        <div class="receipt-content">
            <div class="receipt" id="receipt-container">
                <div class="receipt-header">
                    <div class="receipt-logo">
                        <img src="https://i.imgur.com/Yt7QeLf.png" alt="KPAY+ Logo">
                    </div>
                    <div class="receipt-title">ငွေလွှဲပြေစာ</div>
                    <div class="receipt-subtitle">အတည်ပြုပြီး</div>
                </div>
                
                <div class="receipt-body" id="receipt-details">
                    <!-- Content will be dynamically filled -->
                </div>
                
                <div class="receipt-footer">
                    <div class="receipt-note">ဤငွေလွှဲပြေစာသည် တရားဝင်အတည်ပြုပြီးဖြစ်ပါသည်</div>
                    <div class="receipt-qr">
                        <img id="receipt-qr-code" src="https://api.qrserver.com/v1/create-qr-code/?data=placeholder&size=150x150" alt="QR Code">
                    </div>
                    <div class="receipt-watermark">KPAY+ Premium Payment System</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="download-btn" onclick="downloadReceipt()">
                    <i class="fas fa-download" style="margin-right: 8px;"></i> ဒေါင်းလုပ်ဆွဲမည်
                </button>
                <button class="close-btn" onclick="closeReceipt()">
                    <i class="fas fa-times" style="margin-right: 8px;"></i> ပိတ်မည်
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Error Alert -->
    <div id="error-alert-container" class="alert-container hidden">
        <div class="error-alert">
            <div class="error-alert-header">
                သတိပြုရန်
            </div>
            <div class="error-alert-body">
                <div class="error-alert-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <div class="error-alert-message" id="error-alert-message">
                    အမှားအယွင်းတစ်ခု ဖြစ်ပွားခဲ့ပါသည်။
                </div>
                <button class="error-alert-btn" onclick="closeErrorAlert()">ကောင်းပါပြီ</button>
            </div>
        </div>
    </div>

    <!-- Menu Bar -->
    <div class="menu">
        <button class="menu-button active" onclick="showSection('wallet')" id="wallet-btn">
            <i class="fas fa-wallet menu-icon"></i>
            ငွေအိတ်
        </button>
        <button class="menu-button" onclick="showSection('history')" id="history-btn">
            <i class="fas fa-history menu-icon"></i>
            မှတ်တမ်း
        </button>
        <button class="menu-button" onclick="showSection('services')" id="services-btn">
            <i class="fas fa-th-large menu-icon"></i>
            ဝန်ဆောင်မှု
        </button>
        <button class="menu-button" onclick="showSection('profile')" id="profile-btn">
            <i class="fas fa-user menu-icon"></i>
            ပရိုဖိုင်
        </button>
    </div>

    <!-- Hidden elements for generation -->
    <div style="display: none;" id="photo-content"></div>

    <!-- Audio Elements -->
    <audio id="transfer-sent-sound" src="https://soundbible.com/mp3/accomplished-579.mp3" preload="auto"></audio>
    <audio id="transfer-received-sound" src="https://soundbible.com/mp3/accomplished-579.mp3" preload="auto"></audio>
    <audio id="notification-sound" src="https://soundbible.com/mp3/ping-82822.mp3" preload="auto"></audio>

    <!-- Loading Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Custom Scripts -->
    <script src="script.js"></script>
</body>
</html>

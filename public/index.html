<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OPPER Payment - Premium Mobile Banking</title>
    <link rel="icon" type="image/png" href="https://github.com/Opper125/opper-payment/raw/main/logo.png">
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-dark: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --warning: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            --danger: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            --dark: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --light: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            --glass: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-radius: 20px;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass: rgba(0, 0, 0, 0.25);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #f7fafc;
            --text-secondary: #a0aec0;
            --light: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Poppins', sans-serif;
            background: var(--light);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: var(--transition);
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .glassmorphism {
            background: var(--glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
        }

        .gradient-bg {
            background: var(--primary);
        }

        .gradient-text {
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-pulse-slow {
            animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-bounce-slow {
            animation: bounce 3s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .slide-in-up { animation: slideInUp 0.6s ease-out; }
        .slide-in-right { animation: slideInRight 0.6s ease-out; }
        .slide-in-left { animation: slideInLeft 0.6s ease-out; }
        .fade-in-scale { animation: fadeInScale 0.6s ease-out; }

        .card {
            border-radius: var(--border-radius);
            transition: var(--transition);
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px 0 rgba(31, 38, 135, 0.5);
        }

        .btn {
            border: none;
            border-radius: var(--border-radius);
            padding: 16px 32px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            text-transform: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px 0 rgba(116, 79, 168, 0.75);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(116, 79, 168, 0.9);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
            box-shadow: 0 4px 15px 0 rgba(240, 147, 251, 0.75);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 15px 0 rgba(79, 172, 254, 0.75);
        }

        .btn-success {
            background: var(--success);
            color: white;
            box-shadow: 0 4px 15px 0 rgba(56, 239, 125, 0.75);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: 0 4px 15px 0 rgba(255, 75, 43, 0.75);
        }

        .pin-input {
            width: 50px;
            height: 50px;
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            background: var(--glass);
            backdrop-filter: blur(8px);
            transition: var(--transition);
            margin: 0 4px;
        }

        .pin-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }

        .pin-input.filled {
            background: var(--primary);
            color: white;
            border-color: #667eea;
        }

        .balance-display {
            font-size: 2.5rem;
            font-weight: 900;
            text-align: center;
            margin: 20px 0;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .intro-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeOut 1s ease-in-out 2s forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }

        .logo-container {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .logo-ring {
            width: 120px;
            height: 120px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            position: absolute;
            animation: spin 3s linear infinite;
        }

        .logo-ring:nth-child(1) { animation-delay: 0s; }
        .logo-ring:nth-child(2) { animation-delay: 0.5s; width: 100px; height: 100px; }
        .logo-ring:nth-child(3) { animation-delay: 1s; width: 80px; height: 80px; }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logo-text {
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .intro-tagline {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            margin-top: 10px;
            animation: fadeInUp 1s ease-out 1s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .main-container {
            max-width: 428px;
            margin: 0 auto;
            min-height: 100vh;
            background: transparent;
            position: relative;
            animation: slideInUp 0.8s ease-out 2.5s both;
        }

        .navigation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: calc(100% - 40px);
            max-width: 388px;
        }

        .nav-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 15px 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
            padding: 10px;
            border-radius: 50%;
            position: relative;
        }

        .nav-btn.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-btn:hover {
            color: #667eea;
            transform: scale(1.1);
        }

        .section {
            display: none;
            padding: 20px;
            animation: fadeInScale 0.6s ease-out;
        }

        .section.active {
            display: block;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 40px;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .balance-card {
            background: var(--glass);
            backdrop-filter: blur(16px);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .quick-action {
            background: var(--glass);
            backdrop-filter: blur(16px);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-action:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(31, 38, 135, 0.5);
        }

        .quick-action i {
            font-size: 2rem;
            margin-bottom: 10px;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--glass-border);
            border-radius: var(--border-radius);
            background: var(--glass);
            backdrop-filter: blur(8px);
            font-size: 16px;
            transition: var(--transition);
            color: var(--text-primary);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .user-info-card {
            background: var(--glass);
            backdrop-filter: blur(16px);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 15px 0;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status-approved {
            background: rgba(40, 199, 111, 0.2);
            color: #28c76f;
            border: 1px solid rgba(40, 199, 111, 0.3);
        }

        .status-rejected {
            background: rgba(234, 84, 85, 0.2);
            color: #ea5455;
            border: 1px solid rgba(234, 84, 85, 0.3);
        }

        .transaction-item {
            background: var(--glass);
            backdrop-filter: blur(16px);
            border-radius: var(--border-radius);
            padding: 15px 20px;
            margin-bottom: 10px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(31, 38, 135, 0.3);
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
        }

        .transaction-sent .transaction-icon {
            background: var(--danger);
        }

        .transaction-received .transaction-icon {
            background: var(--success);
        }

        .receipt-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 350px;
            margin: 20px auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 2px solid #f1f3f4;
            position: relative;
        }

        .receipt-header {
            text-align: center;
            border-bottom: 2px dashed #e0e6ed;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .receipt-logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .receipt-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .receipt-subtitle {
            color: #718096;
            font-size: 14px;
        }

        .receipt-content {
            color: #2d3748;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .receipt-row.total {
            border-top: 2px dashed #e0e6ed;
            padding-top: 15px;
            margin-top: 15px;
            font-weight: bold;
            font-size: 16px;
        }

        .receipt-amount {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .receipt-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #e0e6ed;
            color: #718096;
            font-size: 12px;
        }

        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: var(--glass);
            backdrop-filter: blur(16px);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-primary);
        }

        .theme-switcher:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(31, 38, 135, 0.5);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }

        .modal {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 90%;
            width: 400px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            animation: fadeInScale 0.3s ease-out;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: rgba(56, 239, 125, 0.1);
            color: #0f9960;
            border: 1px solid rgba(56, 239, 125, 0.2);
        }

        .alert-error {
            background: rgba(255, 75, 43, 0.1);
            color: #e53e3e;
            border: 1px solid rgba(255, 75, 43, 0.2);
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.1);
            color: #d69e2e;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .ripple:active::before {
            width: 300px;
            height: 300px;
        }

        /* Mobile Optimizations */
        @media (max-width: 428px) {
            .main-container {
                max-width: 100%;
                padding: 0 10px;
            }
            
            .navigation {
                width: calc(100% - 20px);
                bottom: 10px;
            }
            
            .section {
                padding: 15px 10px;
            }
            
            .balance-display {
                font-size: 2rem;
            }
            
            .pin-input {
                width: 45px;
                height: 45px;
                font-size: 20px;
                margin: 0 2px;
            }
        }

        /* Responsive Design */
        @media (min-width: 429px) {
            .main-container {
                border: 1px solid var(--glass-border);
                border-radius: 25px;
                margin-top: 20px;
                margin-bottom: 120px;
                overflow: hidden;
                backdrop-filter: blur(16px);
                background: var(--glass);
            }
        }

        /* Animation delays for staggered effects */
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }
        .stagger-4 { animation-delay: 0.4s; }
        .stagger-5 { animation-delay: 0.5s; }

        /* Scroll behavior */
        html {
            scroll-behavior: smooth;
        }

        /* Focus styles */
        *:focus {
            outline: 2px solid rgba(102, 126, 234, 0.5);
            outline-offset: 2px;
        }

        /* Selection styles */
        ::selection {
            background: rgba(102, 126, 234, 0.3);
            color: inherit;
        }

        /* Scrollbar styles */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }
    </style>
</head>
<body>
    <!-- Intro Animation -->
    <div class="intro-animation" id="intro-animation">
        <div class="logo-container">
            <div class="logo-ring"></div>
            <div class="logo-ring"></div>
            <div class="logo-ring"></div>
            <div class="logo-text">OPPER</div>
            <div class="intro-tagline">Premium Mobile Banking</div>
        </div>
    </div>

    <!-- Theme Switcher -->
    <button class="theme-switcher" onclick="toggleTheme()" aria-label="Toggle Theme">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="header slide-in-up">
                <div class="profile-section">
                    <div class="profile-avatar" id="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <h2 style="font-weight: 700; margin-bottom: 5px;">မင်္ဂလာပါ!</h2>
                        <p style="color: var(--text-secondary); font-size: 14px;" id="user-phone">အကောင့်ဝင်ရောက်ပါ</p>
                    </div>
                </div>
            </div>

            <!-- Balance Card -->
            <div class="balance-card card slide-in-up stagger-1">
                <h3 style="color: var(--text-secondary); font-size: 16px; margin-bottom: 10px;">လက်ကျန်ငွေ</h3>
                <div class="balance-display" id="balance-amount">0</div>
                <div style="font-size: 18px; font-weight: 600; color: var(--text-primary);">Ks</div>
                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; font-size: 14px;">
                    <div>
                        <span style="color: var(--text-secondary);">KYC:</span>
                        <span class="status-badge status-pending" id="kyc-status">စောင့်ဆိုင်းဆဲ</span>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary);">ငွေလွှဲခြင်း:</span>
                        <span class="status-badge status-approved">ခွင့်ပြုထားသည်</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions slide-in-up stagger-2">
                <div class="quick-action card ripple" onclick="showSection('transfer')">
                    <i class="fas fa-paper-plane"></i>
                    <h4 style="font-weight: 600; margin-bottom: 5px;">ငွေလွှဲရန်</h4>
                    <p style="color: var(--text-secondary); font-size: 12px;">မြန်ဆန်သောငွေလွှဲခြင်း</p>
                </div>
                <div class="quick-action card ripple" onclick="showSection('history')">
                    <i class="fas fa-history"></i>
                    <h4 style="font-weight: 600; margin-bottom: 5px;">မှတ်တမ်းများ</h4>
                    <p style="color: var(--text-secondary); font-size: 12px;">လုပ်ဆောင်ချက်များကြည့်ရန်</p>
                </div>
                <div class="quick-action card ripple" onclick="showSection('kyc')">
                    <i class="fas fa-shield-alt"></i>
                    <h4 style="font-weight: 600; margin-bottom: 5px;">KYC</h4>
                    <p style="color: var(--text-secondary); font-size: 12px;">အကောင့်အတည်ပြုခြင်း</p>
                </div>
                <div class="quick-action card ripple" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    <h4 style="font-weight: 600; margin-bottom: 5px;">ဆက်တင်များ</h4>
                    <p style="color: var(--text-secondary); font-size: 12px;">အကောင့်စီမံခန့်ခွဲမှု</p>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="slide-in-up stagger-3">
                <h3 style="font-weight: 700; margin-bottom: 15px; color: var(--text-primary);">နောက်ဆုံးလုပ်ဆောင်ချက်များ</h3>
                <div id="recent-transactions">
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>လုပ်ဆောင်ချက်မှတ်တမ်းမရှိသေးပါ</p>
                    </div>
                </div>
                <button class="btn btn-accent" style="width: 100%; margin-top: 15px;" onclick="showSection('history')">
                    အားလုံးကြည့်ရန်
                </button>
            </div>
        </section>

        <!-- Transfer Section -->
        <section id="transfer" class="section">
            <div class="header">
                <h2 style="font-weight: 700; margin-bottom: 10px;">ငွေလွှဲရန်</h2>
                <p style="color: var(--text-secondary);">အခြားသူထံသို့ ငွေလွှဲပြောင်းပါ</p>
            </div>

            <form id="transfer-form" class="slide-in-up">
                <div class="form-group">
                    <label class="form-label">လက်ခံသူဖုန်းနံပါတ်</label>
                    <input type="tel" class="form-input" id="recipient-phone" placeholder="09xxxxxxxxx" required>
                </div>

                <div class="form-group">
                    <label class="form-label">ငွေပမာณ (Ks)</label>
                    <input type="number" class="form-input" id="transfer-amount" placeholder="0" min="100" required>
                </div>

                <div class="form-group">
                    <label class="form-label">မှတ်ချက် (ထည့်လို က ထည့်နိုင်သည်)</label>
                    <textarea class="form-input" id="transfer-note" rows="3" placeholder="မှတ်ချက်ရေးပါ..."></textarea>
                </div>

                <div id="recipient-info" style="display: none;"></div>

                <button type="submit" class="btn btn-primary ripple" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-paper-plane" style="margin-right: 10px;"></i>
                    ငွေလွှဲမည်
                </button>
            </form>
        </section>

        <!-- History Section -->
        <section id="history" class="section">
            <div class="header">
                <h2 style="font-weight: 700; margin-bottom: 10px;">မှတ်တမ်းများ</h2>
                <p style="color: var(--text-secondary);">သင့်ငွေလွှဲပြောင်းမှုမှတ်တမ်းများ</p>
            </div>

            <div id="transaction-history" class="slide-in-up">
                <div class="empty-state">
                    <i class="fas fa-history"></i>
                    <p>လုပ်ဆောင်ချက်မှတ်တမ်းမရှိသေးပါ</p>
                </div>
            </div>
        </section>

        <!-- KYC Section -->
        <section id="kyc" class="section">
            <div class="header">
                <h2 style="font-weight: 700; margin-bottom: 10px;">KYC အတည်ပြုရန်</h2>
                <p style="color: var(--text-secondary);">သင့်ကိုယ်ရေးအချက်အလက်များ အတည်ပြုပါ</p>
            </div>

            <div class="balance-card card slide-in-up">
                <h3 style="margin-bottom: 15px;">KYC အတည်ပြုမှု အခြေအနေ</h3>
                <div class="status-badge status-pending" id="kyc-status-display">စောင့်ဆိုင်းဆဲ</div>
                <p style="color: var(--text-secondary); margin-top: 15px; font-size: 14px;">
                    သင့်အကောင့်ကို အပြည့်အဝ အသုံးပြုနိုင်ရန် KYC အတည်ပြုမှု လိုအပ်ပါသည်။
                </p>
            </div>

            <form id="kyc-form" class="slide-in-up stagger-1">
                <div class="form-group">
                    <label class="form-label">နိုင်ငံသားစီစစ်ရေးကတ်/နိုင်ငံကူးလက်မှတ်</label>
                    <input type="file" class="form-input" id="passport-file" accept="image/*" required>
                </div>

                <div class="form-group">
                    <label class="form-label">မိမိကိုယ်တိုင် ဓာတ်ပုံ (Selfie)</label>
                    <input type="file" class="form-input" id="selfie-file" accept="image/*" required>
                </div>

                <button type="submit" class="btn btn-success ripple" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-upload" style="margin-right: 10px;"></i>
                    KYC တင်သွင်းမည်
                </button>
            </form>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="header">
                <h2 style="font-weight: 700; margin-bottom: 10px;">ဆက်တင်များ</h2>
                <p style="color: var(--text-secondary);">သင့်အကောင့်ဆက်တင်များ ပြင်ဆင်ပါ</p>
            </div>

            <!-- Account Settings -->
            <div class="balance-card card slide-in-up">
                <h3 style="margin-bottom: 20px;">အကောင့်ဆက်တင်များ</h3>
                
                <div class="form-group">
                    <label class="form-label">ငွေပေးချေမှု PIN (ဂဏန်း ၆ လုံး)</label>
                    <div style="display: flex; justify-content: center; gap: 5px; margin-top: 10px;">
                        <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 0)">
                        <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 1)">
                        <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 2)">
                        <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 3)">
                        <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 4)">
                        <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 5)">
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="updatePin()">
                        PIN ပြောင်းလဲမည်
                    </button>
                </div>
            </div>

            <!-- Theme Settings -->
            <div class="balance-card card slide-in-up stagger-1">
                <h3 style="margin-bottom: 20px;">အပြင်အဆင်</h3>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span>မည်းရောင်ဖန်သားပြင်</span>
                    <label style="position: relative; display: inline-block; width: 60px; height: 34px;">
                        <input type="checkbox" id="dark-mode-toggle" onchange="toggleTheme()" style="opacity: 0; width: 0; height: 0;">
                        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--glass); transition: 0.4s; border-radius: 34px; border: 1px solid var(--glass-border);"></span>
                        <span style="position: absolute; content: ''; height: 26px; width: 26px; left: 4px; bottom: 4px; background: white; transition: 0.4s; border-radius: 50%;"></span>
                    </label>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ငွေလွှဲပြေစာ အလိုအလျောက်သိမ်းဆည်းရန်</span>
                    <label style="position: relative; display: inline-block; width: 60px; height: 34px;">
                        <input type="checkbox" id="auto-save-receipt" checked style="opacity: 0; width: 0; height: 0;">
                        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: var(--success); transition: 0.4s; border-radius: 34px; border: 1px solid rgba(56, 239, 125, 0.3);"></span>
                        <span style="position: absolute; content: ''; height: 26px; width: 26px; right: 4px; bottom: 4px; background: white; transition: 0.4s; border-radius: 50%;"></span>
                    </label>
                </div>
            </div>

            <!-- About -->
            <div class="balance-card card slide-in-up stagger-2">
                <h3 style="margin-bottom: 15px;">အကြောင်း</h3>
                <div style="text-align: center;">
                    <div class="profile-avatar" style="margin: 0 auto 15px;">OPPER</div>
                    <h4 style="font-weight: 600; margin-bottom: 5px;">OPPER Payment v2.2</h4>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
                        Premium Mobile Banking Solution
                    </p>
                    <p style="color: var(--text-secondary); font-size: 12px;">
                        © 2024 OPPER Payment. All rights reserved.
                    </p>
                </div>
            </div>

            <!-- Logout Button -->
            <button class="btn btn-danger ripple" style="width: 100%; margin-top: 20px;" onclick="logout()">
                <i class="fas fa-sign-out-alt" style="margin-right: 10px;"></i>
                အကောင့်မှထွက်မည်
            </button>
        </section>
    </div>

    <!-- Navigation -->
    <nav class="navigation">
        <div class="nav-container">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showSection('home')" data-section="home">
                    <i class="fas fa-home"></i>
                </button>
                <button class="nav-btn" onclick="showSection('transfer')" data-section="transfer">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button class="nav-btn" onclick="showSection('history')" data-section="history">
                    <i class="fas fa-history"></i>
                </button>
                <button class="nav-btn" onclick="showSection('kyc')" data-section="kyc">
                    <i class="fas fa-shield-alt"></i>
                </button>
                <button class="nav-btn" onclick="showSection('settings')" data-section="settings">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- PIN Modal -->
    <div id="pin-modal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">PIN ထည့်သွင်းပါ</h3>
                <p style="color: var(--text-secondary); margin-top: 5px;">လုံခြုံရေးအတွက် PIN ထည့်ပါ</p>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: center; gap: 8px; margin: 20px 0;">
                    <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 0, 'modal')">
                    <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 1, 'modal')">
                    <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 2, 'modal')">
                    <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 3, 'modal')">
                    <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 4, 'modal')">
                    <input type="password" class="pin-input" maxlength="1" oninput="movePinFocus(this, 5, 'modal')">
                </div>
                <div id="pin-error" class="alert alert-error" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>PIN မှားယွင်းနေပါသည်။ ထပ်မံကြိုးစားပါ။</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closePinModal()" style="background: var(--glass); color: var(--text-primary);">ပယ်ဖျက်မည်</button>
                <button class="btn btn-primary" onclick="verifyPin()">အတည်ပြုမည်</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div>
            <div class="loading-spinner"></div>
            <p style="color: white; margin-top: 20px; text-align: center;">ခဏစောင့်ပါ...</p>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const { createClient } = supabase;
        const supabaseUrl = 'https://hwuoekpgfxjfpykmdrlk.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3dW9la3BnZnhqZnB5a21kcmxrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjY4MjMyNzksImV4cCI6MjA0MjM5OTI3OX0.l6wjDOCW4r3fBahMa1Qzg1jdHzKqBKsxzQKZOLYVu9o';
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        // Global Variables
        let currentUser = null;
        let currentBalance = 0;
        let transferData = null;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
        });

        async function initializeApp() {
            // Hide intro animation after delay
            setTimeout(() => {
                document.getElementById('intro-animation').style.display = 'none';
            }, 3000);

            // Load user data if logged in
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                currentUser = JSON.parse(userData);
                await loadUserData();
            }

            // Load theme preference
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeIcon(theme);
        }

        function setupEventListeners() {
            // Form submissions
            document.getElementById('transfer-form').addEventListener('submit', handleTransferSubmit);
            document.getElementById('kyc-form').addEventListener('submit', handleKYCSubmit);

            // Phone number input for recipient lookup
            document.getElementById('recipient-phone').addEventListener('input', debounce(lookupRecipient, 500));

            // Pin input handling
            const pinInputs = document.querySelectorAll('.pin-input');
            pinInputs.forEach((input, index) => {
                input.addEventListener('keydown', handlePinKeydown);
                input.addEventListener('paste', handlePinPaste);
            });
        }

        // Navigation Functions
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionName).classList.add('active');

            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

            // Load section-specific data
            switch(sectionName) {
                case 'home':
                    loadDashboard();
                    break;
                case 'history':
                    loadTransactionHistory();
                    break;
                case 'kyc':
                    loadKYCStatus();
                    break;
            }
        }

        // User Authentication and Data
        async function loadUserData() {
            if (!currentUser) return;

            try {
                showLoading(true);

                // Update UI with user data
                document.getElementById('user-phone').textContent = currentUser.phone;
                document.getElementById('profile-avatar').textContent = currentUser.phone.slice(-2);

                // Get user balance and status
                const { data: userData, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('phone', currentUser.phone)
                    .single();

                if (error) throw error;

                currentUser = { ...currentUser, ...userData };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                // Update balance with animation
                animateBalance(currentBalance, userData.balance || 0);
                currentBalance = userData.balance || 0;

                // Update KYC status
                updateKYCStatus(userData.kyc_status);

            } catch (error) {
                console.error('Error loading user data:', error);
                showAlert('ဒေတာခေါ်ယူရာတွင် အမှားအယွင်းရှိပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        function animateBalance(from, to) {
            const element = document.getElementById('balance-amount');
            const duration = 2000; // 2 seconds
            const steps = 60;
            const increment = (to - from) / steps;
            let current = from;
            let step = 0;

            const timer = setInterval(() => {
                step++;
                current += increment;
                
                if (step >= steps) {
                    current = to;
                    clearInterval(timer);
                }
                
                element.textContent = Math.floor(current).toLocaleString();
            }, duration / steps);
        }

        function updateKYCStatus(status) {
            const statusElements = document.querySelectorAll('#kyc-status, #kyc-status-display');
            
            statusElements.forEach(element => {
                element.className = 'status-badge ';
                
                switch(status) {
                    case 'approved':
                        element.className += 'status-approved';
                        element.textContent = 'အတည်ပြုပြီး';
                        break;
                    case 'rejected':
                        element.className += 'status-rejected';
                        element.textContent = 'ငြင်းပယ်ခံထား';
                        break;
                    default:
                        element.className += 'status-pending';
                        element.textContent = 'စောင့်ဆိုင်းဆဲ';
                }
            });
        }

        // Transfer Functions
        async function handleTransferSubmit(e) {
            e.preventDefault();
            
            const recipientPhone = document.getElementById('recipient-phone').value;
            const amount = parseInt(document.getElementById('transfer-amount').value);
            const note = document.getElementById('transfer-note').value;

            // Validation
            if (!recipientPhone || !amount) {
                showAlert('ကျေးဇူးပြု၍ လိုအပ်သော အချက်အလက်များ ဖြည့်သွင်းပါ', 'warning');
                return;
            }

            if (amount < 100) {
                showAlert('အနည်းဆုံး ၁၀၀ ကျပ် လွှဲပြောင်းရပါမည်', 'warning');
                return;
            }

            if (amount > currentBalance) {
                showAlert('လက်ကျန်ငွေ မလုံလောက်ပါ', 'error');
                return;
            }

            if (recipientPhone === currentUser.phone) {
                showAlert('မိမိကိုယ်တိုင်ကို ငွေလွှဲ၍မရပါ', 'error');
                return;
            }

            // Store transfer data and show PIN modal
            transferData = { recipientPhone, amount, note };
            showPinModal();
        }

        async function lookupRecipient(phone) {
            if (!phone || phone.length < 8) {
                document.getElementById('recipient-info').style.display = 'none';
                return;
            }

            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('phone, created_at')
                    .eq('phone', phone)
                    .single();

                const recipientInfo = document.getElementById('recipient-info');
                
                if (error || !data) {
                    recipientInfo.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>ဤဖုန်းနံပါတ်ဖြင့် အကောင့်ရှာမတွေ့ပါ</span>
                        </div>
                    `;
                } else {
                    recipientInfo.innerHTML = `
                        <div class="user-info-card">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="profile-avatar" style="width: 40px; height: 40px; font-size: 16px;">
                                    ${data.phone.slice(-2)}
                                </div>
                                <div>
                                    <h4 style="font-weight: 600; margin-bottom: 5px;">${data.phone}</h4>
                                    <p style="color: var(--text-secondary); font-size: 14px;">
                                        <i class="fas fa-check-circle" style="color: var(--success); margin-right: 5px;"></i>
                                        အတည်ပြုပြီးသော အကောင့်
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                recipientInfo.style.display = 'block';
            } catch (error) {
                console.error('Error looking up recipient:', error);
            }
        }

        async function processTransfer() {
            if (!transferData) return;

            try {
                showLoading(true);

                const { recipientPhone, amount, note } = transferData;

                // Create transaction record
                const { data: transaction, error: transactionError } = await supabaseClient
                    .from('transactions')
                    .insert([{
                        from_phone: currentUser.phone,
                        to_phone: recipientPhone,
                        amount: amount,
                        note: note || '',
                        status: 'completed'
                    }])
                    .select()
                    .single();

                if (transactionError) throw transactionError;

                // Update sender balance
                const { error: senderError } = await supabaseClient
                    .from('users')
                    .update({ balance: currentBalance - amount })
                    .eq('phone', currentUser.phone);

                if (senderError) throw senderError;

                // Update recipient balance
                const { data: recipient } = await supabaseClient
                    .from('users')
                    .select('balance')
                    .eq('phone', recipientPhone)
                    .single();

                if (recipient) {
                    const { error: recipientError } = await supabaseClient
                        .from('users')
                        .update({ balance: (recipient.balance || 0) + amount })
                        .eq('phone', recipientPhone);

                    if (recipientError) throw recipientError;
                }

                // Update local balance
                currentBalance -= amount;
                animateBalance(currentBalance + amount, currentBalance);

                // Show success message
                showAlert('ငွေလွှဲခြင်း အောင်မြင်ပါသည်', 'success');

                // Generate and show receipt
                generateReceipt(transaction);

                // Clear form
                document.getElementById('transfer-form').reset();
                document.getElementById('recipient-info').style.display = 'none';

                // Refresh data
                await loadUserData();
                loadTransactionHistory();

            } catch (error) {
                console.error('Error processing transfer:', error);
                showAlert('ငွေလွှဲရာတွင် အမှားအယွင်းရှိပါသည်', 'error');
            } finally {
                showLoading(false);
                transferData = null;
            }
        }

        // Receipt Generation
        function generateReceipt(transaction) {
            const receiptContent = `
                <div class="receipt-container" id="receipt-content">
                    <div class="receipt-header">
                        <div class="receipt-logo">
                            <img src="https://github.com/Opper125/opper-payment/raw/main/logo.png" 
                                 alt="OPPER" 
                                 style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
                                 onerror="this.outerHTML='<div style=\'width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;color:white;font-size:24px;font-weight:bold;\'>OP</div>'">
                        </div>
                        <div class="receipt-title">OPPER Payment</div>
                        <div class="receipt-subtitle">ငွေလွှဲပြေစာ</div>
                    </div>
                    
                    <div class="receipt-content">
                        <div class="receipt-amount">${transaction.amount.toLocaleString()} Ks</div>
                        
                        <div class="receipt-row">
                            <span>လွှဲသူ:</span>
                            <span>${transaction.from_phone}</span>
                        </div>
                        
                        <div class="receipt-row">
                            <span>လက်ခံသူ:</span>
                            <span>${transaction.to_phone}</span>
                        </div>
                        
                        <div class="receipt-row">
                            <span>ရက်စွဲ:</span>
                            <span>${new Date(transaction.created_at).toLocaleString('my-MM')}</span>
                        </div>
                        
                        <div class="receipt-row">
                            <span>လုပ်ဆောင်ချက်ID:</span>
                            <span>#${transaction.id}</span>
                        </div>
                        
                        ${transaction.note ? `
                        <div class="receipt-row">
                            <span>မှတ်ချက်:</span>
                            <span>${transaction.note}</span>
                        </div>
                        ` : ''}
                        
                        <div class="receipt-row total">
                            <span>စုစုပေါင်း:</span>
                            <span>${transaction.amount.toLocaleString()} Ks</span>
                        </div>
                    </div>
                    
                    <div class="receipt-footer">
                        <p>အထူးကျေးဇူးတင်ပါတယ်</p>
                        <p>OPPER Payment ကို အသုံးပြုပေးတဲ့အတွက်</p>
                        <p style="margin-top: 10px; font-size: 10px;">
                            လုပ်ဆောင်ချက်အား ၂၄ နာရီအတွင်း ပြန်ဖျက်နိုင်ပါသည်
                        </p>
                    </div>
                </div>
            `;

            // Show receipt modal
            showModal('ငွေလွှဲပြေစာ', receiptContent, [
                {
                    text: 'ပြေစာ Download လုပ်မည်',
                    class: 'btn-primary',
                    onclick: () => downloadReceipt('receipt-content', `OPPER_Receipt_${transaction.id}`)
                },
                {
                    text: 'ပိတ်မည်',
                    class: 'btn-secondary',
                    onclick: closeModal
                }
            ]);
        }

        async function downloadReceipt(elementId, filename) {
            try {
                const element = document.getElementById(elementId);
                const canvas = await html2canvas(element, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true
                });

                const link = document.createElement('a');
                link.download = `${filename}.png`;
                link.href = canvas.toDataURL();
                link.click();

                showAlert('ပြေစာကို အောင်မြင်စွာ Download လုပ်ပြီးပါပြီ', 'success');
            } catch (error) {
                console.error('Error downloading receipt:', error);
                showAlert('ပြေစာ Download လုပ်ရာတွင် အမှားအယွင်းရှိပါသည်', 'error');
            }
        }

        // Transaction History
        async function loadTransactionHistory() {
            if (!currentUser) return;

            try {
                const { data, error } = await supabaseClient
                    .from('transactions')
                    .select('*')
                    .or(`from_phone.eq.${currentUser.phone},to_phone.eq.${currentUser.phone}`)
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (error) throw error;

                const container = document.getElementById('transaction-history');
                const recentContainer = document.getElementById('recent-transactions');

                if (!data || data.length === 0) {
                    const emptyState = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>လုပ်ဆောင်ချက်မှတ်တမ်းမရှိသေးပါ</p>
                        </div>
                    `;
                    container.innerHTML = emptyState;
                    recentContainer.innerHTML = emptyState;
                    return;
                }

                const transactionsHTML = data.map((transaction, index) => {
                    const isSent = transaction.from_phone === currentUser.phone;
                    const otherPhone = isSent ? transaction.to_phone : transaction.from_phone;
                    const amount = isSent ? -transaction.amount : transaction.amount;
                    const type = isSent ? 'sent' : 'received';
                    
                    return `
                        <div class="transaction-item transaction-${type} slide-in-up stagger-${Math.min(index + 1, 5)}">
                            <div class="transaction-icon">
                                <i class="fas fa-${isSent ? 'arrow-up' : 'arrow-down'}"></i>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="font-weight: 600; margin-bottom: 5px;">
                                    ${isSent ? 'ငွေလွှဲခြင်း' : 'ငွေလက်ခံခြင်း'}
                                </h4>
                                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 5px;">
                                    ${isSent ? 'လက်ခံသူ' : 'ပေးပို့သူ'}: ${otherPhone}
                                </p>
                                <p style="color: var(--text-secondary); font-size: 12px;">
                                    ${new Date(transaction.created_at).toLocaleDateString('my-MM')}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold; font-size: 16px; color: ${isSent ? '#e53e3e' : '#0f9960'};">
                                    ${amount > 0 ? '+' : ''}${amount.toLocaleString()} Ks
                                </div>
                                ${transaction.note ? `
                                <p style="color: var(--text-secondary); font-size: 12px; margin-top: 5px;">
                                    ${transaction.note}
                                </p>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = transactionsHTML;
                
                // Show only recent 3 transactions in home
                const recentHTML = data.slice(0, 3).map((transaction, index) => {
                    const isSent = transaction.from_phone === currentUser.phone;
                    const otherPhone = isSent ? transaction.to_phone : transaction.from_phone;
                    const amount = isSent ? -transaction.amount : transaction.amount;
                    const type = isSent ? 'sent' : 'received';
                    
                    return `
                        <div class="transaction-item transaction-${type} slide-in-up stagger-${index + 1}">
                            <div class="transaction-icon">
                                <i class="fas fa-${isSent ? 'arrow-up' : 'arrow-down'}"></i>
                            </div>
                            <div style="flex: 1;">
                                <h4 style="font-weight: 600; margin-bottom: 5px;">
                                    ${isSent ? 'ငွေလွှဲခြင်း' : 'ငွေလက်ခံခြင်း'}
                                </h4>
                                <p style="color: var(--text-secondary); font-size: 14px;">
                                    ${otherPhone}
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: bold; color: ${isSent ? '#e53e3e' : '#0f9960'};">
                                    ${amount > 0 ? '+' : ''}${amount.toLocaleString()} Ks
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                recentContainer.innerHTML = recentHTML || `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>လုပ်ဆောင်ချက်မှတ်တမ်းမရှိသေးပါ</p>
                    </div>
                `;

            } catch (error) {
                console.error('Error loading transaction history:', error);
            }
        }

        // KYC Functions
        async function handleKYCSubmit(e) {
            e.preventDefault();
            
            const passportFile = document.getElementById('passport-file').files[0];
            const selfieFile = document.getElementById('selfie-file').files[0];

            if (!passportFile || !selfieFile) {
                showAlert('ကျေးဇူးပြု၍ လိုအပ်သော ဖိုင်များ ရွေးချယ်ပါ', 'warning');
                return;
            }

            try {
                showLoading(true);

                // Convert files to base64
                const passportBase64 = await fileToBase64(passportFile);
                const selfieBase64 = await fileToBase64(selfieFile);

                // Submit KYC data
                const { error } = await supabaseClient
                    .from('kyc_submissions')
                    .upsert([{
                        phone: currentUser.phone,
                        passport_image: passportBase64,
                        selfie_image: selfieBase64,
                        status: 'pending'
                    }]);

                if (error) throw error;

                // Update user KYC status
                const { error: userError } = await supabaseClient
                    .from('users')
                    .update({ kyc_status: 'pending' })
                    .eq('phone', currentUser.phone);

                if (userError) throw userError;

                showAlert('KYC လျှောက်လွှာ အောင်မြင်စွာ တင်သွင်းပြီးပါပြီ', 'success');
                
                // Clear form
                document.getElementById('kyc-form').reset();
                
                // Update UI
                updateKYCStatus('pending');

            } catch (error) {
                console.error('Error submitting KYC:', error);
                showAlert('KYC တင်သွင်းရာတွင် အမှားအယွင်းရှိပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        async function loadKYCStatus() {
            if (!currentUser) return;

            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('kyc_status')
                    .eq('phone', currentUser.phone)
                    .single();

                if (error) throw error;

                updateKYCStatus(data.kyc_status);
            } catch (error) {
                console.error('Error loading KYC status:', error);
            }
        }

        // PIN Functions
        function showPinModal() {
            document.getElementById('pin-modal').style.display = 'flex';
            // Focus first pin input
            const firstInput = document.querySelector('#pin-modal .pin-input');
            if (firstInput) {
                setTimeout(() => firstInput.focus(), 100);
            }
        }

        function closePinModal() {
            document.getElementById('pin-modal').style.display = 'none';
            document.getElementById('pin-error').style.display = 'none';
            // Clear pin inputs
            document.querySelectorAll('#pin-modal .pin-input').forEach(input => {
                input.value = '';
                input.classList.remove('filled');
            });
        }

        function movePinFocus(input, index, context = '') {
            if (input.value.length === 1) {
                input.classList.add('filled');
                // Move to next input
                const nextIndex = index + 1;
                const nextInput = context === 'modal' 
                    ? document.querySelectorAll('#pin-modal .pin-input')[nextIndex]
                    : document.querySelectorAll('.pin-input')[nextIndex];
                
                if (nextInput) {
                    nextInput.focus();
                } else {
                    // All pins filled, auto-verify if in modal
                    if (context === 'modal') {
                        setTimeout(verifyPin, 200);
                    }
                }
            } else {
                input.classList.remove('filled');
            }
        }

        function handlePinKeydown(e) {
            const input = e.target;
            const index = Array.from(input.parentElement.children).indexOf(input);
            
            if (e.key === 'Backspace' && input.value === '') {
                // Move to previous input
                const prevInput = input.parentElement.children[index - 1];
                if (prevInput) {
                    prevInput.focus();
                    prevInput.value = '';
                    prevInput.classList.remove('filled');
                }
            }
        }

        function handlePinPaste(e) {
            e.preventDefault();
            const paste = (e.clipboardData || window.clipboardData).getData('text');
            const pins = paste.replace(/\D/g, '').slice(0, 6).split('');
            
            const inputs = e.target.parentElement.children;
            pins.forEach((pin, index) => {
                if (inputs[index]) {
                    inputs[index].value = pin;
                    inputs[index].classList.add('filled');
                }
            });
        }

        async function verifyPin() {
            const pinInputs = document.querySelectorAll('#pin-modal .pin-input');
            const pin = Array.from(pinInputs).map(input => input.value).join('');

            if (pin.length !== 6) {
                document.getElementById('pin-error').style.display = 'flex';
                return;
            }

            try {
                // Verify PIN with stored user PIN
                if (currentUser.pin && currentUser.pin === pin) {
                    closePinModal();
                    await processTransfer();
                } else {
                    document.getElementById('pin-error').style.display = 'flex';
                    // Clear inputs
                    pinInputs.forEach(input => {
                        input.value = '';
                        input.classList.remove('filled');
                    });
                    pinInputs[0].focus();
                }
            } catch (error) {
                console.error('Error verifying PIN:', error);
                document.getElementById('pin-error').style.display = 'flex';
            }
        }

        async function updatePin() {
            const pinInputs = document.querySelectorAll('#settings .pin-input');
            const newPin = Array.from(pinInputs).map(input => input.value).join('');

            if (newPin.length !== 6) {
                showAlert('ကျေးဇူးပြု၍ PIN ၆ လုံးကို ဖြည့်သွင်းပါ', 'warning');
                return;
            }

            try {
                showLoading(true);

                const { error } = await supabaseClient
                    .from('users')
                    .update({ pin: newPin })
                    .eq('phone', currentUser.phone);

                if (error) throw error;

                currentUser.pin = newPin;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                showAlert('PIN အောင်မြင်စွာ ပြောင်းလဲပြီးပါပြီ', 'success');
                
                // Clear inputs
                pinInputs.forEach(input => {
                    input.value = '';
                    input.classList.remove('filled');
                });

            } catch (error) {
                console.error('Error updating PIN:', error);
                showAlert('PIN ပြောင်းလဲရာတွင် အမှားအယွင်းရှိပါသည်', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Theme Functions
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
            const toggle = document.getElementById('dark-mode-toggle');
            
            if (theme === 'dark') {
                icon.className = 'fas fa-sun';
                if (toggle) toggle.checked = true;
            } else {
                icon.className = 'fas fa-moon';
                if (toggle) toggle.checked = false;
            }
        }

        // Dashboard Functions
        async function loadDashboard() {
            await loadUserData();
            loadTransactionHistory();
        }

        // Utility Functions
        function showLoading(show) {
            document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
        }

        function showAlert(message, type = 'info') {
            // Remove existing alerts
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());

            const alertHTML = `
                <div class="alert alert-${type}" style="position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 10001; max-width: 90%; animation: slideInUp 0.3s ease-out;">
                    <i class="fas fa-${getAlertIcon(type)}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.insertAdjacentHTML('afterbegin', alertHTML);

            // Auto remove after 4 seconds
            setTimeout(() => {
                const alert = document.querySelector('.alert');
                if (alert) {
                    alert.style.animation = 'slideInUp 0.3s ease-out reverse';
                    setTimeout(() => alert.remove(), 300);
                }
            }, 4000);
        }

        function getAlertIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-triangle';
                case 'warning': return 'exclamation-circle';
                default: return 'info-circle';
            }
        }

        function showModal(title, content, buttons = []) {
            const modalHTML = `
                <div class="modal-overlay" id="custom-modal" style="display: flex;">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">${title}</h3>
                        </div>
                        <div class="modal-body">
                            ${content}
                        </div>
                        <div class="modal-footer">
                            ${buttons.map(btn => `
                                <button class="btn ${btn.class}" onclick="${btn.onclick}">
                                    ${btn.text}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            // Remove existing modal
            const existingModal = document.getElementById('custom-modal');
            if (existingModal) existingModal.remove();

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function closeModal() {
            const modal = document.getElementById('custom-modal');
            if (modal) modal.remove();
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function logout() {
            if (confirm('အကောင့်မှ ထွက်ရန် သေချာပါသလား?')) {
                localStorage.removeItem('currentUser');
                location.reload();
            }
        }

        // Simulated login function (replace with actual authentication)
        function simulateLogin() {
            const phone = prompt('ဖုန်းနံပါတ် ထည့်ပါ (စမ်းသပ်ရန်):') || '09123456789';
            currentUser = {
                phone: phone,
                pin: '123456'
            };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            loadUserData();
        }

        // Initialize with simulated user if no user is logged in
        if (!currentUser) {
            setTimeout(() => {
                simulateLogin();
            }, 3500);
        }

        // Service Worker Registration for PWA support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }

        // Add ripple effect to buttons
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('ripple') || e.target.closest('.ripple')) {
                const button = e.target.classList.contains('ripple') ? e.target : e.target.closest('.ripple');
                const ripple = document.createElement('span');
                const rect = button.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.classList.add('ripple-effect');
                
                button.appendChild(ripple);
                
                setTimeout(() => ripple.remove(), 600);
            }
        });

        // Add CSS for ripple effect
        const rippleCSS = `
            .ripple-effect {
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                transform: scale(0);
                animation: ripple 0.6s linear;
                pointer-events: none;
            }
            
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        
        const style = document.createElement('style');
        style.textContent = rippleCSS;
        document.head.appendChild(style);
    </script>
</body>
</html>
